var Mr=Object.defineProperty;var Or=(f,t,r)=>t in f?Mr(f,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):f[t]=r;var q=(f,t,r)=>Or(f,typeof t!="symbol"?t+"":t,r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))p(h);new MutationObserver(h=>{for(const m of h)if(m.type==="childList")for(const _ of m.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&p(_)}).observe(document,{childList:!0,subtree:!0});function r(h){const m={};return h.integrity&&(m.integrity=h.integrity),h.referrerPolicy&&(m.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?m.credentials="include":h.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function p(h){if(h.ep)return;h.ep=!0;const m=r(h);fetch(h.href,m)}})();var ve,$,dr,re,Yt,fr,hr,cr,Mt,Et,Rt,le={},pr=[],Br=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,_e=Array.isArray;function te(f,t){for(var r in t)f[r]=t[r];return f}function Ot(f){f&&f.parentNode&&f.parentNode.removeChild(f)}function kr(f,t,r){var p,h,m,_={};for(m in t)m=="key"?p=t[m]:m=="ref"?h=t[m]:_[m]=t[m];if(arguments.length>2&&(_.children=arguments.length>3?ve.call(arguments,2):r),typeof f=="function"&&f.defaultProps!=null)for(m in f.defaultProps)_[m]===void 0&&(_[m]=f.defaultProps[m]);return he(f,_,p,h,null)}function he(f,t,r,p,h){var m={type:f,props:t,key:r,ref:p,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:h??++dr,__i:-1,__u:0};return h==null&&$.vnode!=null&&$.vnode(m),m}function se(f){return f.children}function ce(f,t){this.props=f,this.context=t}function ae(f,t){if(t==null)return f.__?ae(f.__,f.__i+1):null;for(var r;t<f.__k.length;t++)if((r=f.__k[t])!=null&&r.__e!=null)return r.__e;return typeof f.type=="function"?ae(f):null}function mr(f){var t,r;if((f=f.__)!=null&&f.__c!=null){for(f.__e=f.__c.base=null,t=0;t<f.__k.length;t++)if((r=f.__k[t])!=null&&r.__e!=null){f.__e=f.__c.base=r.__e;break}return mr(f)}}function Xt(f){(!f.__d&&(f.__d=!0)&&re.push(f)&&!me.__r++||Yt!==$.debounceRendering)&&((Yt=$.debounceRendering)||fr)(me)}function me(){for(var f,t,r,p,h,m,_,v=1;re.length;)re.length>v&&re.sort(hr),f=re.shift(),v=re.length,f.__d&&(r=void 0,h=(p=(t=f).__v).__e,m=[],_=[],t.__P&&((r=te({},p)).__v=p.__v+1,$.vnode&&$.vnode(r),Bt(t.__P,r,p,t.__n,t.__P.namespaceURI,32&p.__u?[h]:null,m,h??ae(p),!!(32&p.__u),_),r.__v=p.__v,r.__.__k[r.__i]=r,vr(m,r,_),r.__e!=h&&mr(r)));me.__r=0}function gr(f,t,r,p,h,m,_,v,g,c,a){var l,i,s,u,n,d,e=p&&p.__k||pr,o=t.length;for(g=Nr(r,t,e,g,o),l=0;l<o;l++)(s=r.__k[l])!=null&&(i=s.__i===-1?le:e[s.__i]||le,s.__i=l,d=Bt(f,s,i,h,m,_,v,g,c,a),u=s.__e,s.ref&&i.ref!=s.ref&&(i.ref&&kt(i.ref,null,s),a.push(s.ref,s.__c||u,s)),n==null&&u!=null&&(n=u),4&s.__u||i.__k===s.__k?g=xr(s,g,f):typeof s.type=="function"&&d!==void 0?g=d:u&&(g=u.nextSibling),s.__u&=-7);return r.__e=n,g}function Nr(f,t,r,p,h){var m,_,v,g,c,a=r.length,l=a,i=0;for(f.__k=new Array(h),m=0;m<h;m++)(_=t[m])!=null&&typeof _!="boolean"&&typeof _!="function"?(g=m+i,(_=f.__k[m]=typeof _=="string"||typeof _=="number"||typeof _=="bigint"||_.constructor==String?he(null,_,null,null,null):_e(_)?he(se,{children:_},null,null,null):_.constructor===void 0&&_.__b>0?he(_.type,_.props,_.key,_.ref?_.ref:null,_.__v):_).__=f,_.__b=f.__b+1,v=null,(c=_.__i=qr(_,r,g,l))!==-1&&(l--,(v=r[c])&&(v.__u|=2)),v==null||v.__v===null?(c==-1&&(h>a?i--:h<a&&i++),typeof _.type!="function"&&(_.__u|=4)):c!=g&&(c==g-1?i--:c==g+1?i++:(c>g?i--:i++,_.__u|=4))):f.__k[m]=null;if(l)for(m=0;m<a;m++)(v=r[m])!=null&&(2&v.__u)==0&&(v.__e==p&&(p=ae(v)),yr(v,v));return p}function xr(f,t,r){var p,h;if(typeof f.type=="function"){for(p=f.__k,h=0;p&&h<p.length;h++)p[h]&&(p[h].__=f,t=xr(p[h],t,r));return t}f.__e!=t&&(t&&f.type&&!r.contains(t)&&(t=ae(f)),r.insertBefore(f.__e,t||null),t=f.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function qr(f,t,r,p){var h,m,_=f.key,v=f.type,g=t[r];if(g===null&&f.key==null||g&&_==g.key&&v===g.type&&(2&g.__u)==0)return r;if(p>(g!=null&&(2&g.__u)==0?1:0))for(h=r-1,m=r+1;h>=0||m<t.length;){if(h>=0){if((g=t[h])&&(2&g.__u)==0&&_==g.key&&v===g.type)return h;h--}if(m<t.length){if((g=t[m])&&(2&g.__u)==0&&_==g.key&&v===g.type)return m;m++}}return-1}function Kt(f,t,r){t[0]=="-"?f.setProperty(t,r??""):f[t]=r==null?"":typeof r!="number"||Br.test(t)?r:r+"px"}function fe(f,t,r,p,h){var m;e:if(t=="style")if(typeof r=="string")f.style.cssText=r;else{if(typeof p=="string"&&(f.style.cssText=p=""),p)for(t in p)r&&t in r||Kt(f.style,t,"");if(r)for(t in r)p&&r[t]===p[t]||Kt(f.style,t,r[t])}else if(t[0]=="o"&&t[1]=="n")m=t!=(t=t.replace(cr,"$1")),t=t.toLowerCase()in f||t=="onFocusOut"||t=="onFocusIn"?t.toLowerCase().slice(2):t.slice(2),f.l||(f.l={}),f.l[t+m]=r,r?p?r.t=p.t:(r.t=Mt,f.addEventListener(t,m?Rt:Et,m)):f.removeEventListener(t,m?Rt:Et,m);else{if(h=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in f)try{f[t]=r??"";break e}catch{}typeof r=="function"||(r==null||r===!1&&t[4]!="-"?f.removeAttribute(t):f.setAttribute(t,t=="popover"&&r==1?"":r))}}function jt(f){return function(t){if(this.l){var r=this.l[t.type+f];if(t.u==null)t.u=Mt++;else if(t.u<r.t)return;return r($.event?$.event(t):t)}}}function Bt(f,t,r,p,h,m,_,v,g,c){var a,l,i,s,u,n,d,e,o,x,y,b,F,S,w,A,C,I=t.type;if(t.constructor!==void 0)return null;128&r.__u&&(g=!!(32&r.__u),m=[v=t.__e=r.__e]),(a=$.__b)&&a(t);e:if(typeof I=="function")try{if(e=t.props,o="prototype"in I&&I.prototype.render,x=(a=I.contextType)&&p[a.__c],y=a?x?x.props.value:a.__:p,r.__c?d=(l=t.__c=r.__c).__=l.__E:(o?t.__c=l=new I(e,y):(t.__c=l=new ce(e,y),l.constructor=I,l.render=zr),x&&x.sub(l),l.props=e,l.state||(l.state={}),l.context=y,l.__n=p,i=l.__d=!0,l.__h=[],l._sb=[]),o&&l.__s==null&&(l.__s=l.state),o&&I.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=te({},l.__s)),te(l.__s,I.getDerivedStateFromProps(e,l.__s))),s=l.props,u=l.state,l.__v=t,i)o&&I.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),o&&l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(o&&I.getDerivedStateFromProps==null&&e!==s&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(e,y),!l.__e&&(l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(e,l.__s,y)===!1||t.__v==r.__v)){for(t.__v!=r.__v&&(l.props=e,l.state=l.__s,l.__d=!1),t.__e=r.__e,t.__k=r.__k,t.__k.some(function(T){T&&(T.__=t)}),b=0;b<l._sb.length;b++)l.__h.push(l._sb[b]);l._sb=[],l.__h.length&&_.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(e,l.__s,y),o&&l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(s,u,n)})}if(l.context=y,l.props=e,l.__P=f,l.__e=!1,F=$.__r,S=0,o){for(l.state=l.__s,l.__d=!1,F&&F(t),a=l.render(l.props,l.state,l.context),w=0;w<l._sb.length;w++)l.__h.push(l._sb[w]);l._sb=[]}else do l.__d=!1,F&&F(t),a=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++S<25);l.state=l.__s,l.getChildContext!=null&&(p=te(te({},p),l.getChildContext())),o&&!i&&l.getSnapshotBeforeUpdate!=null&&(n=l.getSnapshotBeforeUpdate(s,u)),A=a,a!=null&&a.type===se&&a.key==null&&(A=_r(a.props.children)),v=gr(f,_e(A)?A:[A],t,r,p,h,m,_,v,g,c),l.base=t.__e,t.__u&=-161,l.__h.length&&_.push(l),d&&(l.__E=l.__=null)}catch(T){if(t.__v=null,g||m!=null)if(T.then){for(t.__u|=g?160:128;v&&v.nodeType==8&&v.nextSibling;)v=v.nextSibling;m[m.indexOf(v)]=null,t.__e=v}else for(C=m.length;C--;)Ot(m[C]);else t.__e=r.__e,t.__k=r.__k;$.__e(T,t,r)}else m==null&&t.__v==r.__v?(t.__k=r.__k,t.__e=r.__e):v=t.__e=Vr(r.__e,t,r,p,h,m,_,g,c);return(a=$.diffed)&&a(t),128&t.__u?void 0:v}function vr(f,t,r){for(var p=0;p<r.length;p++)kt(r[p],r[++p],r[++p]);$.__c&&$.__c(t,f),f.some(function(h){try{f=h.__h,h.__h=[],f.some(function(m){m.call(h)})}catch(m){$.__e(m,h.__v)}})}function _r(f){return typeof f!="object"||f==null?f:_e(f)?f.map(_r):te({},f)}function Vr(f,t,r,p,h,m,_,v,g){var c,a,l,i,s,u,n,d=r.props,e=t.props,o=t.type;if(o=="svg"?h="http://www.w3.org/2000/svg":o=="math"?h="http://www.w3.org/1998/Math/MathML":h||(h="http://www.w3.org/1999/xhtml"),m!=null){for(c=0;c<m.length;c++)if((s=m[c])&&"setAttribute"in s==!!o&&(o?s.localName==o:s.nodeType==3)){f=s,m[c]=null;break}}if(f==null){if(o==null)return document.createTextNode(e);f=document.createElementNS(h,o,e.is&&e),v&&($.__m&&$.__m(t,m),v=!1),m=null}if(o===null)d===e||v&&f.data===e||(f.data=e);else{if(m=m&&ve.call(f.childNodes),d=r.props||le,!v&&m!=null)for(d={},c=0;c<f.attributes.length;c++)d[(s=f.attributes[c]).name]=s.value;for(c in d)if(s=d[c],c!="children"){if(c=="dangerouslySetInnerHTML")l=s;else if(!(c in e)){if(c=="value"&&"defaultValue"in e||c=="checked"&&"defaultChecked"in e)continue;fe(f,c,null,s,h)}}for(c in e)s=e[c],c=="children"?i=s:c=="dangerouslySetInnerHTML"?a=s:c=="value"?u=s:c=="checked"?n=s:v&&typeof s!="function"||d[c]===s||fe(f,c,s,d[c],h);if(a)v||l&&(a.__html===l.__html||a.__html===f.innerHTML)||(f.innerHTML=a.__html),t.__k=[];else if(l&&(f.innerHTML=""),gr(t.type==="template"?f.content:f,_e(i)?i:[i],t,r,p,o=="foreignObject"?"http://www.w3.org/1999/xhtml":h,m,_,m?m[0]:r.__k&&ae(r,0),v,g),m!=null)for(c=m.length;c--;)Ot(m[c]);v||(c="value",o=="progress"&&u==null?f.removeAttribute("value"):u!==void 0&&(u!==f[c]||o=="progress"&&!u||o=="option"&&u!==d[c])&&fe(f,c,u,d[c],h),c="checked",n!==void 0&&n!==f[c]&&fe(f,c,n,d[c],h))}return f}function kt(f,t,r){try{if(typeof f=="function"){var p=typeof f.__u=="function";p&&f.__u(),p&&t==null||(f.__u=f(t))}else f.current=t}catch(h){$.__e(h,r)}}function yr(f,t,r){var p,h;if($.unmount&&$.unmount(f),(p=f.ref)&&(p.current&&p.current!==f.__e||kt(p,null,t)),(p=f.__c)!=null){if(p.componentWillUnmount)try{p.componentWillUnmount()}catch(m){$.__e(m,t)}p.base=p.__P=null}if(p=f.__k)for(h=0;h<p.length;h++)p[h]&&yr(p[h],t,r||typeof f.type!="function");r||Ot(f.__e),f.__c=f.__=f.__e=void 0}function zr(f,t,r){return this.constructor(f,r)}function Gr(f,t,r){var p,h,m,_;t==document&&(t=document.documentElement),$.__&&$.__(f,t),h=(p=!1)?null:t.__k,m=[],_=[],Bt(t,f=t.__k=kr(se,null,[f]),h||le,le,t.namespaceURI,h?null:t.firstChild?ve.call(t.childNodes):null,m,h?h.__e:t.firstChild,p,_),vr(m,f,_)}ve=pr.slice,$={__e:function(f,t,r,p){for(var h,m,_;t=t.__;)if((h=t.__c)&&!h.__)try{if((m=h.constructor)&&m.getDerivedStateFromError!=null&&(h.setState(m.getDerivedStateFromError(f)),_=h.__d),h.componentDidCatch!=null&&(h.componentDidCatch(f,p||{}),_=h.__d),_)return h.__E=h}catch(v){f=v}throw f}},dr=0,ce.prototype.setState=function(f,t){var r;r=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=te({},this.state),typeof f=="function"&&(f=f(te({},r),this.props)),f&&te(r,f),f!=null&&this.__v&&(t&&this._sb.push(t),Xt(this))},ce.prototype.forceUpdate=function(f){this.__v&&(this.__e=!0,f&&this.__h.push(f),Xt(this))},ce.prototype.render=se,re=[],fr=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,hr=function(f,t){return f.__v.__b-t.__v.__b},me.__r=0,cr=/(PointerCapture)$|Capture$/i,Mt=0,Et=jt(!1),Rt=jt(!0);var Wr=0;function X(f,t,r,p,h,m){t||(t={});var _,v,g=t;if("ref"in g)for(v in g={},t)v=="ref"?_=t[v]:g[v]=t[v];var c={type:f,props:g,key:r,ref:_,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Wr,__i:-1,__u:0,__source:h,__self:m};if(typeof f=="function"&&(_=f.defaultProps))for(v in _)g[v]===void 0&&(g[v]=_[v]);return $.vnode&&$.vnode(c),c}var de,j,De,Qt,ge=0,Sr=[],Z=$,Zt=Z.__b,Jt=Z.__r,ei=Z.diffed,ti=Z.__c,ii=Z.unmount,ri=Z.__;function Nt(f,t){Z.__h&&Z.__h(j,f,ge||t),ge=0;var r=j.__H||(j.__H={__:[],__h:[]});return f>=r.__.length&&r.__.push({}),r.__[f]}function ne(f){return ge=1,Hr(Tr,f)}function Hr(f,t,r){var p=Nt(de++,2);if(p.t=f,!p.__c&&(p.__=[Tr(void 0,t),function(v){var g=p.__N?p.__N[0]:p.__[0],c=p.t(g,v);g!==c&&(p.__N=[c,p.__[1]],p.__c.setState({}))}],p.__c=j,!j.__f)){var h=function(v,g,c){if(!p.__c.__H)return!0;var a=p.__c.__H.__.filter(function(i){return!!i.__c});if(a.every(function(i){return!i.__N}))return!m||m.call(this,v,g,c);var l=p.__c.props!==v;return a.forEach(function(i){if(i.__N){var s=i.__[0];i.__=i.__N,i.__N=void 0,s!==i.__[0]&&(l=!0)}}),m&&m.call(this,v,g,c)||l};j.__f=!0;var m=j.shouldComponentUpdate,_=j.componentWillUpdate;j.componentWillUpdate=function(v,g,c){if(this.__e){var a=m;m=void 0,h(v,g,c),m=a}_&&_.call(this,v,g,c)},j.shouldComponentUpdate=h}return p.__N||p.__}function Ue(f,t){var r=Nt(de++,3);!Z.__s&&br(r.__H,t)&&(r.__=f,r.u=t,j.__H.__h.push(r))}function ni(f){return ge=5,$r(function(){return{current:f}},[])}function $r(f,t){var r=Nt(de++,7);return br(r.__H,t)&&(r.__=f(),r.__H=t,r.__h=f),r.__}function Yr(){for(var f;f=Sr.shift();)if(f.__P&&f.__H)try{f.__H.__h.forEach(pe),f.__H.__h.forEach(Lt),f.__H.__h=[]}catch(t){f.__H.__h=[],Z.__e(t,f.__v)}}Z.__b=function(f){j=null,Zt&&Zt(f)},Z.__=function(f,t){f&&t.__k&&t.__k.__m&&(f.__m=t.__k.__m),ri&&ri(f,t)},Z.__r=function(f){Jt&&Jt(f),de=0;var t=(j=f.__c).__H;t&&(De===j?(t.__h=[],j.__h=[],t.__.forEach(function(r){r.__N&&(r.__=r.__N),r.u=r.__N=void 0})):(t.__h.forEach(pe),t.__h.forEach(Lt),t.__h=[],de=0)),De=j},Z.diffed=function(f){ei&&ei(f);var t=f.__c;t&&t.__H&&(t.__H.__h.length&&(Sr.push(t)!==1&&Qt===Z.requestAnimationFrame||((Qt=Z.requestAnimationFrame)||Xr)(Yr)),t.__H.__.forEach(function(r){r.u&&(r.__H=r.u),r.u=void 0})),De=j=null},Z.__c=function(f,t){t.some(function(r){try{r.__h.forEach(pe),r.__h=r.__h.filter(function(p){return!p.__||Lt(p)})}catch(p){t.some(function(h){h.__h&&(h.__h=[])}),t=[],Z.__e(p,r.__v)}}),ti&&ti(f,t)},Z.unmount=function(f){ii&&ii(f);var t,r=f.__c;r&&r.__H&&(r.__H.__.forEach(function(p){try{pe(p)}catch(h){t=h}}),r.__H=void 0,t&&Z.__e(t,r.__v))};var ai=typeof requestAnimationFrame=="function";function Xr(f){var t,r=function(){clearTimeout(p),ai&&cancelAnimationFrame(t),setTimeout(f)},p=setTimeout(r,100);ai&&(t=requestAnimationFrame(r))}function pe(f){var t=j,r=f.__c;typeof r=="function"&&(f.__c=void 0,r()),j=t}function Lt(f){var t=j;f.__c=f.__(),j=t}function br(f,t){return!f||f.length!==t.length||t.some(function(r,p){return r!==f[p]})}function Tr(f,t){return typeof t=="function"?t(f):t}var si=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Kr(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var Ie,oi;function ee(){if(oi)return Ie;oi=1;var f=function(){this.init=function(){var r={};this.on=function(p,h){r[p]||(r[p]=[]),r[p]=r[p].concat(h)},this.off=function(p,h){var m;return r[p]?(m=r[p].indexOf(h),r[p]=r[p].slice(),r[p].splice(m,1),m>-1):!1},this.trigger=function(p){var h,m,_,v;if(h=r[p],!!h)if(arguments.length===2)for(_=h.length,m=0;m<_;++m)h[m].call(this,arguments[1]);else{for(v=[],m=arguments.length,m=1;m<arguments.length;++m)v.push(arguments[m]);for(_=h.length,m=0;m<_;++m)h[m].apply(this,v)}},this.dispose=function(){r={}}}};return f.prototype.pipe=function(t){return this.on("data",function(r){t.push(r)}),this.on("done",function(r){t.flush(r)}),this.on("partialdone",function(r){t.partialFlush(r)}),this.on("endedtimeline",function(r){t.endTimeline(r)}),this.on("reset",function(r){t.reset(r)}),t},f.prototype.push=function(t){this.trigger("data",t)},f.prototype.flush=function(t){this.trigger("done",t)},f.prototype.partialFlush=function(t){this.trigger("partialdone",t)},f.prototype.endTimeline=function(t){this.trigger("endedtimeline",t)},f.prototype.reset=function(t){this.trigger("reset",t)},Ie=f,Ie}var Ce,ui;function ie(){if(ui)return Ce;ui=1;var f=9e4,t,r,p,h,m,_,v;return t=function(c){return c*f},r=function(c,a){return c*a},p=function(c){return c/f},h=function(c,a){return c/a},m=function(c,a){return t(h(c,a))},_=function(c,a){return r(p(c),a)},v=function(c,a,l){return p(l?c:c-a)},Ce={ONE_SECOND_IN_TS:f,secondsToVideoTs:t,secondsToAudioTs:r,videoTsToSeconds:p,audioTsToSeconds:h,audioTsToVideoTs:m,videoTsToAudioTs:_,metadataTsToSeconds:v},Ce}var Ee,li;function ye(){if(li)return Ee;li=1;var f=ee(),t=ie().ONE_SECOND_IN_TS,r,p=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return r=function(m){var _,v=0;r.prototype.init.call(this),this.skipWarn_=function(g,c){this.trigger("log",{level:"warn",message:"adts skiping bytes "+g+" to "+c+" in frame "+v+" outside syncword"})},this.push=function(g){var c=0,a,l,i,s,u;if(m||(v=0),g.type==="audio"){_&&_.length?(i=_,_=new Uint8Array(i.byteLength+g.data.byteLength),_.set(i),_.set(g.data,i.byteLength)):_=g.data;for(var n;c+7<_.length;){if(_[c]!==255||(_[c+1]&246)!==240){typeof n!="number"&&(n=c),c++;continue}if(typeof n=="number"&&(this.skipWarn_(n,c),n=null),l=(~_[c+1]&1)*2,a=(_[c+3]&3)<<11|_[c+4]<<3|(_[c+5]&224)>>5,s=((_[c+6]&3)+1)*1024,u=s*t/p[(_[c+2]&60)>>>2],_.byteLength-c<a)break;this.trigger("data",{pts:g.pts+v*u,dts:g.dts+v*u,sampleCount:s,audioobjecttype:(_[c+2]>>>6&3)+1,channelcount:(_[c+2]&1)<<2|(_[c+3]&192)>>>6,samplerate:p[(_[c+2]&60)>>>2],samplingfrequencyindex:(_[c+2]&60)>>>2,samplesize:16,data:_.subarray(c+7+l,c+a)}),v++,c+=a}typeof n=="number"&&(this.skipWarn_(n,c),n=null),_=_.subarray(c)}},this.flush=function(){v=0,this.trigger("done")},this.reset=function(){_=void 0,this.trigger("reset")},this.endTimeline=function(){_=void 0,this.trigger("endedtimeline")}},r.prototype=new f,Ee=r,Ee}var Re,di;function jr(){if(di)return Re;di=1;var f;return f=function(r){var p=r.byteLength,h=0,m=0;this.length=function(){return 8*p},this.bitsAvailable=function(){return 8*p+m},this.loadWord=function(){var _=r.byteLength-p,v=new Uint8Array(4),g=Math.min(4,p);if(g===0)throw new Error("no bytes available");v.set(r.subarray(_,_+g)),h=new DataView(v.buffer).getUint32(0),m=g*8,p-=g},this.skipBits=function(_){var v;m>_?(h<<=_,m-=_):(_-=m,v=Math.floor(_/8),_-=v*8,p-=v,this.loadWord(),h<<=_,m-=_)},this.readBits=function(_){var v=Math.min(m,_),g=h>>>32-v;return m-=v,m>0?h<<=v:p>0&&this.loadWord(),v=_-v,v>0?g<<v|this.readBits(v):g},this.skipLeadingZeros=function(){var _;for(_=0;_<m;++_)if((h&2147483648>>>_)!==0)return h<<=_,m-=_,_;return this.loadWord(),_+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var _=this.skipLeadingZeros();return this.readBits(_+1)-1},this.readExpGolomb=function(){var _=this.readUnsignedExpGolomb();return 1&_?1+_>>>1:-1*(_>>>1)},this.readBoolean=function(){return this.readBits(1)===1},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()},Re=f,Re}var Le,fi;function qt(){if(fi)return Le;fi=1;var f=ee(),t=jr(),r,p,h;return p=function(){var _=0,v,g;p.prototype.init.call(this),this.push=function(c){var a;g?(a=new Uint8Array(g.byteLength+c.data.byteLength),a.set(g),a.set(c.data,g.byteLength),g=a):g=c.data;for(var l=g.byteLength;_<l-3;_++)if(g[_+2]===1){v=_+5;break}for(;v<l;)switch(g[v]){case 0:if(g[v-1]!==0){v+=2;break}else if(g[v-2]!==0){v++;break}_+3!==v-2&&this.trigger("data",g.subarray(_+3,v-2));do v++;while(g[v]!==1&&v<l);_=v-2,v+=3;break;case 1:if(g[v-1]!==0||g[v-2]!==0){v+=3;break}this.trigger("data",g.subarray(_+3,v-2)),_=v-2,v+=3;break;default:v+=3;break}g=g.subarray(_),v-=_,_=0},this.reset=function(){g=null,_=0,this.trigger("reset")},this.flush=function(){g&&g.byteLength>3&&this.trigger("data",g.subarray(_+3)),g=null,_=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},p.prototype=new f,h={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},r=function(){var _=new p,v,g,c,a,l,i,s;r.prototype.init.call(this),v=this,this.push=function(u){u.type==="video"&&(g=u.trackId,c=u.pts,a=u.dts,_.push(u))},_.on("data",function(u){var n={trackId:g,pts:c,dts:a,data:u,nalUnitTypeCode:u[0]&31};switch(n.nalUnitTypeCode){case 5:n.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:n.nalUnitType="sei_rbsp",n.escapedRBSP=l(u.subarray(1));break;case 7:n.nalUnitType="seq_parameter_set_rbsp",n.escapedRBSP=l(u.subarray(1)),n.config=i(n.escapedRBSP);break;case 8:n.nalUnitType="pic_parameter_set_rbsp";break;case 9:n.nalUnitType="access_unit_delimiter_rbsp";break}v.trigger("data",n)}),_.on("done",function(){v.trigger("done")}),_.on("partialdone",function(){v.trigger("partialdone")}),_.on("reset",function(){v.trigger("reset")}),_.on("endedtimeline",function(){v.trigger("endedtimeline")}),this.flush=function(){_.flush()},this.partialFlush=function(){_.partialFlush()},this.reset=function(){_.reset()},this.endTimeline=function(){_.endTimeline()},s=function(n,d){var e=8,o=8,x,y;for(x=0;x<n;x++)o!==0&&(y=d.readExpGolomb(),o=(e+y+256)%256),e=o===0?e:o},l=function(n){for(var d=n.byteLength,e=[],o=1,x,y;o<d-2;)n[o]===0&&n[o+1]===0&&n[o+2]===3?(e.push(o+2),o+=2):o++;if(e.length===0)return n;x=d-e.length,y=new Uint8Array(x);var b=0;for(o=0;o<x;b++,o++)b===e[0]&&(b++,e.shift()),y[o]=n[b];return y},i=function(n){var d=0,e=0,o=0,x=0,y,b,F,S,w,A,C,I,T,U,D,E=[1,1],R,V;if(y=new t(n),b=y.readUnsignedByte(),S=y.readUnsignedByte(),F=y.readUnsignedByte(),y.skipUnsignedExpGolomb(),h[b]&&(w=y.readUnsignedExpGolomb(),w===3&&y.skipBits(1),y.skipUnsignedExpGolomb(),y.skipUnsignedExpGolomb(),y.skipBits(1),y.readBoolean()))for(D=w!==3?8:12,V=0;V<D;V++)y.readBoolean()&&(V<6?s(16,y):s(64,y));if(y.skipUnsignedExpGolomb(),A=y.readUnsignedExpGolomb(),A===0)y.readUnsignedExpGolomb();else if(A===1)for(y.skipBits(1),y.skipExpGolomb(),y.skipExpGolomb(),C=y.readUnsignedExpGolomb(),V=0;V<C;V++)y.skipExpGolomb();if(y.skipUnsignedExpGolomb(),y.skipBits(1),I=y.readUnsignedExpGolomb(),T=y.readUnsignedExpGolomb(),U=y.readBits(1),U===0&&y.skipBits(1),y.skipBits(1),y.readBoolean()&&(d=y.readUnsignedExpGolomb(),e=y.readUnsignedExpGolomb(),o=y.readUnsignedExpGolomb(),x=y.readUnsignedExpGolomb()),y.readBoolean()&&y.readBoolean()){switch(R=y.readUnsignedByte(),R){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:{E=[y.readUnsignedByte()<<8|y.readUnsignedByte(),y.readUnsignedByte()<<8|y.readUnsignedByte()];break}}E&&E[0]/E[1]}return{profileIdc:b,levelIdc:F,profileCompatibility:S,width:(I+1)*16-d*2-e*2,height:(2-U)*(T+1)*16-o*2-x*2,sarRatio:E}}},r.prototype=new f,Le={H264Stream:r,NalByteStream:p},Le}var Me,hi;function wr(){return hi||(hi=1,Me={Adts:ye(),h264:qt()}),Me}var Oe,ci;function oe(){if(ci)return Oe;ci=1;var f=Math.pow(2,32),t=function(p){var h=new DataView(p.buffer,p.byteOffset,p.byteLength),m;return h.getBigUint64?(m=h.getBigUint64(0),m<Number.MAX_SAFE_INTEGER?Number(m):m):h.getUint32(0)*f+h.getUint32(4)};return Oe={getUint64:t,MAX_UINT32:f},Oe}var Be,pi;function Se(){if(pi)return Be;pi=1;var f=oe().MAX_UINT32,t,r,p,h,m,_,v,g,c,a,l,i,s,u,n,d,e,o,x,y,b,F,S,w,A,C,I,T,U,D,E,R,V,H,Y,K;return function(){var B;if(S={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},!(typeof Uint8Array>"u")){for(B in S)S.hasOwnProperty(B)&&(S[B]=[B.charCodeAt(0),B.charCodeAt(1),B.charCodeAt(2),B.charCodeAt(3)]);w=new Uint8Array([105,115,111,109]),C=new Uint8Array([97,118,99,49]),A=new Uint8Array([0,0,0,1]),I=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),T=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),U={video:I,audio:T},R=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),E=new Uint8Array([0,0,0,0,0,0,0,0]),V=new Uint8Array([0,0,0,0,0,0,0,0]),H=V,Y=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),K=V,D=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),t=function(P){var M=[],L=0,O,z,k;for(O=1;O<arguments.length;O++)M.push(arguments[O]);for(O=M.length;O--;)L+=M[O].byteLength;for(z=new Uint8Array(L+8),k=new DataView(z.buffer,z.byteOffset,z.byteLength),k.setUint32(0,z.byteLength),z.set(P,4),O=0,L=8;O<M.length;O++)z.set(M[O],L),L+=M[O].byteLength;return z},r=function(){return t(S.dinf,t(S.dref,R))},p=function(P){return t(S.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,P.audioobjecttype<<3|P.samplingfrequencyindex>>>1,P.samplingfrequencyindex<<7|P.channelcount<<3,6,1,2]))},h=function(){return t(S.ftyp,w,A,w,C)},d=function(P){return t(S.hdlr,U[P])},m=function(P){return t(S.mdat,P)},n=function(P){var M=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,P.duration>>>24&255,P.duration>>>16&255,P.duration>>>8&255,P.duration&255,85,196,0,0]);return P.samplerate&&(M[12]=P.samplerate>>>24&255,M[13]=P.samplerate>>>16&255,M[14]=P.samplerate>>>8&255,M[15]=P.samplerate&255),t(S.mdhd,M)},u=function(P){return t(S.mdia,n(P),d(P.type),v(P))},_=function(P){return t(S.mfhd,new Uint8Array([0,0,0,0,(P&4278190080)>>24,(P&16711680)>>16,(P&65280)>>8,P&255]))},v=function(P){return t(S.minf,P.type==="video"?t(S.vmhd,D):t(S.smhd,E),r(),o(P))},g=function(P,M){for(var L=[],O=M.length;O--;)L[O]=y(M[O]);return t.apply(null,[S.moof,_(P)].concat(L))},c=function(P){for(var M=P.length,L=[];M--;)L[M]=i(P[M]);return t.apply(null,[S.moov,l(4294967295)].concat(L).concat(a(P)))},a=function(P){for(var M=P.length,L=[];M--;)L[M]=b(P[M]);return t.apply(null,[S.mvex].concat(L))},l=function(P){var M=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(P&4278190080)>>24,(P&16711680)>>16,(P&65280)>>8,P&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t(S.mvhd,M)},e=function(P){var M=P.samples||[],L=new Uint8Array(4+M.length),O,z;for(z=0;z<M.length;z++)O=M[z].flags,L[z+4]=O.dependsOn<<4|O.isDependedOn<<2|O.hasRedundancy;return t(S.sdtp,L)},o=function(P){return t(S.stbl,x(P),t(S.stts,K),t(S.stsc,H),t(S.stsz,Y),t(S.stco,V))},function(){var B,P;x=function(L){return t(S.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),L.type==="video"?B(L):P(L))},B=function(L){var O=L.sps||[],z=L.pps||[],k=[],N=[],W,Q;for(W=0;W<O.length;W++)k.push((O[W].byteLength&65280)>>>8),k.push(O[W].byteLength&255),k=k.concat(Array.prototype.slice.call(O[W]));for(W=0;W<z.length;W++)N.push((z[W].byteLength&65280)>>>8),N.push(z[W].byteLength&255),N=N.concat(Array.prototype.slice.call(z[W]));if(Q=[S.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(L.width&65280)>>8,L.width&255,(L.height&65280)>>8,L.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),t(S.avcC,new Uint8Array([1,L.profileIdc,L.profileCompatibility,L.levelIdc,255].concat([O.length],k,[z.length],N))),t(S.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],L.sarRatio){var G=L.sarRatio[0],J=L.sarRatio[1];Q.push(t(S.pasp,new Uint8Array([(G&4278190080)>>24,(G&16711680)>>16,(G&65280)>>8,G&255,(J&4278190080)>>24,(J&16711680)>>16,(J&65280)>>8,J&255])))}return t.apply(null,Q)},P=function(L){return t(S.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(L.channelcount&65280)>>8,L.channelcount&255,(L.samplesize&65280)>>8,L.samplesize&255,0,0,0,0,(L.samplerate&65280)>>8,L.samplerate&255,0,0]),p(L))}}(),s=function(P){var M=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(P.id&4278190080)>>24,(P.id&16711680)>>16,(P.id&65280)>>8,P.id&255,0,0,0,0,(P.duration&4278190080)>>24,(P.duration&16711680)>>16,(P.duration&65280)>>8,P.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(P.width&65280)>>8,P.width&255,0,0,(P.height&65280)>>8,P.height&255,0,0]);return t(S.tkhd,M)},y=function(P){var M,L,O,z,k,N,W;return M=t(S.tfhd,new Uint8Array([0,0,0,58,(P.id&4278190080)>>24,(P.id&16711680)>>16,(P.id&65280)>>8,P.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),N=Math.floor(P.baseMediaDecodeTime/f),W=Math.floor(P.baseMediaDecodeTime%f),L=t(S.tfdt,new Uint8Array([1,0,0,0,N>>>24&255,N>>>16&255,N>>>8&255,N&255,W>>>24&255,W>>>16&255,W>>>8&255,W&255])),k=92,P.type==="audio"?(O=F(P,k),t(S.traf,M,L,O)):(z=e(P),O=F(P,z.length+k),t(S.traf,M,L,O,z))},i=function(P){return P.duration=P.duration||4294967295,t(S.trak,s(P),u(P))},b=function(P){var M=new Uint8Array([0,0,0,0,(P.id&4278190080)>>24,(P.id&16711680)>>16,(P.id&65280)>>8,P.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return P.type!=="video"&&(M[M.length-1]=0),t(S.trex,M)},function(){var B,P,M;M=function(O,z){var k=0,N=0,W=0,Q=0;return O.length&&(O[0].duration!==void 0&&(k=1),O[0].size!==void 0&&(N=2),O[0].flags!==void 0&&(W=4),O[0].compositionTimeOffset!==void 0&&(Q=8)),[0,0,k|N|W|Q,1,(O.length&4278190080)>>>24,(O.length&16711680)>>>16,(O.length&65280)>>>8,O.length&255,(z&4278190080)>>>24,(z&16711680)>>>16,(z&65280)>>>8,z&255]},P=function(O,z){var k,N,W,Q,G,J;for(Q=O.samples||[],z+=20+16*Q.length,W=M(Q,z),N=new Uint8Array(W.length+Q.length*16),N.set(W),k=W.length,J=0;J<Q.length;J++)G=Q[J],N[k++]=(G.duration&4278190080)>>>24,N[k++]=(G.duration&16711680)>>>16,N[k++]=(G.duration&65280)>>>8,N[k++]=G.duration&255,N[k++]=(G.size&4278190080)>>>24,N[k++]=(G.size&16711680)>>>16,N[k++]=(G.size&65280)>>>8,N[k++]=G.size&255,N[k++]=G.flags.isLeading<<2|G.flags.dependsOn,N[k++]=G.flags.isDependedOn<<6|G.flags.hasRedundancy<<4|G.flags.paddingValue<<1|G.flags.isNonSyncSample,N[k++]=G.flags.degradationPriority&61440,N[k++]=G.flags.degradationPriority&15,N[k++]=(G.compositionTimeOffset&4278190080)>>>24,N[k++]=(G.compositionTimeOffset&16711680)>>>16,N[k++]=(G.compositionTimeOffset&65280)>>>8,N[k++]=G.compositionTimeOffset&255;return t(S.trun,N)},B=function(O,z){var k,N,W,Q,G,J;for(Q=O.samples||[],z+=20+8*Q.length,W=M(Q,z),k=new Uint8Array(W.length+Q.length*8),k.set(W),N=W.length,J=0;J<Q.length;J++)G=Q[J],k[N++]=(G.duration&4278190080)>>>24,k[N++]=(G.duration&16711680)>>>16,k[N++]=(G.duration&65280)>>>8,k[N++]=G.duration&255,k[N++]=(G.size&4278190080)>>>24,k[N++]=(G.size&16711680)>>>16,k[N++]=(G.size&65280)>>>8,k[N++]=G.size&255;return t(S.trun,k)},F=function(O,z){return O.type==="audio"?B(O,z):P(O,z)}}(),Be={ftyp:h,mdat:m,moof:g,moov:c,initSegment:function(P){var M=h(),L=c(P),O;return O=new Uint8Array(M.byteLength+L.byteLength),O.set(M),O.set(L,M.byteLength),O}},Be}var ke,mi;function xe(){if(mi)return ke;mi=1;var f=function(p){return p>>>0},t=function(p){return("00"+p.toString(16)).slice(-2)};return ke={toUnsigned:f,toHexString:t},ke}var Ne,gi;function Vt(){if(gi)return Ne;gi=1;var f=function(r){var p="";return p+=String.fromCharCode(r[0]),p+=String.fromCharCode(r[1]),p+=String.fromCharCode(r[2]),p+=String.fromCharCode(r[3]),p};return Ne=f,Ne}var qe,xi;function zt(){if(xi)return qe;xi=1;var f=xe().toUnsigned,t=Vt(),r=function p(h,m){var _=[],v,g,c,a,l;if(!m.length)return null;for(v=0;v<h.byteLength;)g=f(h[v]<<24|h[v+1]<<16|h[v+2]<<8|h[v+3]),c=t(h.subarray(v+4,v+8)),a=g>1?v+g:h.byteLength,c===m[0]&&(m.length===1?_.push(h.subarray(v+8,a)):(l=p(h.subarray(v+8,a),m.slice(1)),l.length&&(_=_.concat(l)))),v=a;return _};return qe=r,qe}var Ve,vi;function Qr(){if(vi)return Ve;vi=1;var f=function(r){for(var p=0,h=String.fromCharCode(r[p]),m="";h!=="\0";)m+=h,p++,h=String.fromCharCode(r[p]);return m+=h,m};return Ve={uint8ToCString:f},Ve}var ze,_i;function Zr(){if(_i)return ze;_i=1;var f=Qr().uint8ToCString,t=oe().getUint64,r=function(v){var g=4,c=v[0],a,l,i,s,u,n,d,e;if(c===0){a=f(v.subarray(g)),g+=a.length,l=f(v.subarray(g)),g+=l.length;var o=new DataView(v.buffer);i=o.getUint32(g),g+=4,u=o.getUint32(g),g+=4,n=o.getUint32(g),g+=4,d=o.getUint32(g),g+=4}else if(c===1){var o=new DataView(v.buffer);i=o.getUint32(g),g+=4,s=t(v.subarray(g)),g+=8,n=o.getUint32(g),g+=4,d=o.getUint32(g),g+=4,a=f(v.subarray(g)),g+=a.length,l=f(v.subarray(g)),g+=l.length}e=new Uint8Array(v.subarray(g,v.byteLength));var x={scheme_id_uri:a,value:l,timescale:i||1,presentation_time:s,presentation_time_delta:u,event_duration:n,id:d,message_data:e};return h(c,x)?x:void 0},p=function(v,g,c,a){return v||v===0?v/g:a+c/g},h=function(v,g){var c=g.scheme_id_uri!=="\0",a=v===0&&m(g.presentation_time_delta)&&c,l=v===1&&m(g.presentation_time)&&c;return!(v>1)&&a||l},m=function(v){return v!==void 0||v!==null};return ze={parseEmsgBox:r,scaleTime:p},ze}var Ge,yi;function Gt(){if(yi)return Ge;yi=1;var f=function(r){var p=new DataView(r.buffer,r.byteOffset,r.byteLength),h={version:r[0],flags:new Uint8Array(r.subarray(1,4)),trackId:p.getUint32(4)},m=h.flags[2]&1,_=h.flags[2]&2,v=h.flags[2]&8,g=h.flags[2]&16,c=h.flags[2]&32,a=h.flags[0]&65536,l=h.flags[0]&131072,i;return i=8,m&&(i+=4,h.baseDataOffset=p.getUint32(12),i+=4),_&&(h.sampleDescriptionIndex=p.getUint32(i),i+=4),v&&(h.defaultSampleDuration=p.getUint32(i),i+=4),g&&(h.defaultSampleSize=p.getUint32(i),i+=4),c&&(h.defaultSampleFlags=p.getUint32(i)),a&&(h.durationIsEmpty=!0),!m&&l&&(h.baseDataOffsetIsMoof=!0),h};return Ge=f,Ge}var We,Si;function Jr(){if(Si)return We;Si=1;var f=function(r){return{isLeading:(r[0]&12)>>>2,dependsOn:r[0]&3,isDependedOn:(r[1]&192)>>>6,hasRedundancy:(r[1]&48)>>>4,paddingValue:(r[1]&14)>>>1,isNonSyncSample:r[1]&1,degradationPriority:r[2]<<8|r[3]}};return We=f,We}var He,bi;function Wt(){if(bi)return He;bi=1;var f=Jr(),t=function(p){var h={version:p[0],flags:new Uint8Array(p.subarray(1,4)),samples:[]},m=new DataView(p.buffer,p.byteOffset,p.byteLength),_=h.flags[2]&1,v=h.flags[2]&4,g=h.flags[1]&1,c=h.flags[1]&2,a=h.flags[1]&4,l=h.flags[1]&8,i=m.getUint32(4),s=8,u;for(_&&(h.dataOffset=m.getInt32(s),s+=4),v&&i&&(u={flags:f(p.subarray(s,s+4))},s+=4,g&&(u.duration=m.getUint32(s),s+=4),c&&(u.size=m.getUint32(s),s+=4),l&&(h.version===1?u.compositionTimeOffset=m.getInt32(s):u.compositionTimeOffset=m.getUint32(s),s+=4),h.samples.push(u),i--);i--;)u={},g&&(u.duration=m.getUint32(s),s+=4),c&&(u.size=m.getUint32(s),s+=4),a&&(u.flags=f(p.subarray(s,s+4)),s+=4),l&&(h.version===1?u.compositionTimeOffset=m.getInt32(s):u.compositionTimeOffset=m.getUint32(s),s+=4),h.samples.push(u);return h};return He=t,He}var $e,Ti;function Ht(){if(Ti)return $e;Ti=1;var f=xe().toUnsigned,t=oe().getUint64,r=function(h){var m={version:h[0],flags:new Uint8Array(h.subarray(1,4))};return m.version===1?m.baseMediaDecodeTime=t(h.subarray(4)):m.baseMediaDecodeTime=f(h[4]<<24|h[5]<<16|h[6]<<8|h[7]),m};return $e=r,$e}var Ye,wi;function Fr(){if(wi)return Ye;wi=1;var f;return typeof window<"u"?f=window:typeof si<"u"?f=si:typeof self<"u"?f=self:f={},Ye=f,Ye}var Xe,Fi;function en(){if(Fi)return Xe;Fi=1;var f=function(r,p,h){if(!r)return-1;for(var m=h;m<r.length;m++)if(r[m]===p)return m;return-1};return Xe={typedArrayIndexOf:f},Xe}var Ke,Ai;function Ar(){if(Ai)return Ke;Ai=1;var f=en().typedArrayIndexOf,t={Utf8:3},r=function(c,a,l){var i,s="";for(i=a;i<l;i++)s+="%"+("00"+c[i].toString(16)).slice(-2);return s},p=function(c,a,l){return decodeURIComponent(r(c,a,l))},h=function(c,a,l){return unescape(r(c,a,l))},m=function(c){return c[0]<<21|c[1]<<14|c[2]<<7|c[3]},_={APIC:function(c){var a=1,l,i,s="-->";c.data[0]===t.Utf8&&(l=f(c.data,0,a),!(l<0)&&(c.mimeType=h(c.data,a,l),a=l+1,c.pictureType=c.data[a],a++,i=f(c.data,0,a),!(i<0)&&(c.description=p(c.data,a,i),a=i+1,c.mimeType===s?c.url=h(c.data,a,c.data.length):c.pictureData=c.data.subarray(a,c.data.length))))},"T*":function(c){c.data[0]===t.Utf8&&(c.value=p(c.data,1,c.data.length).replace(/\0*$/,""),c.values=c.value.split("\0"))},TXXX:function(c){var a;c.data[0]===t.Utf8&&(a=f(c.data,0,1),a!==-1&&(c.description=p(c.data,1,a),c.value=p(c.data,a+1,c.data.length).replace(/\0*$/,""),c.data=c.value))},"W*":function(c){c.url=h(c.data,0,c.data.length).replace(/\0.*$/,"")},WXXX:function(c){var a;c.data[0]===t.Utf8&&(a=f(c.data,0,1),a!==-1&&(c.description=p(c.data,1,a),c.url=h(c.data,a+1,c.data.length).replace(/\0.*$/,"")))},PRIV:function(c){var a;for(a=0;a<c.data.length;a++)if(c.data[a]===0){c.owner=h(c.data,0,a);break}c.privateData=c.data.subarray(a+1),c.data=c.privateData}},v=function(c){var a,l,i=10,s=0,u=[];if(!(c.length<10||c[0]!==73||c[1]!==68||c[2]!==51)){s=m(c.subarray(6,10)),s+=10;var n=c[5]&64;n&&(i+=4,i+=m(c.subarray(10,14)),s-=m(c.subarray(16,20)));do{if(a=m(c.subarray(i+4,i+8)),a<1)break;l=String.fromCharCode(c[i],c[i+1],c[i+2],c[i+3]);var d={id:l,data:c.subarray(i+10,i+a+10)};d.key=d.id,_[d.id]?_[d.id](d):d.id[0]==="T"?_["T*"](d):d.id[0]==="W"&&_["W*"](d),u.push(d),i+=10,i+=a}while(i<s);return u}};return Ke={parseId3Frames:v,parseSyncSafeInteger:m,frameParsers:_},Ke}var je,Pi;function tn(){if(Pi)return je;Pi=1;var f=xe().toUnsigned,t=xe().toHexString,r=zt(),p=Vt(),h=Zr(),m=Gt(),_=Wt(),v=Ht(),g=oe().getUint64,c,a,l,i,s,u,n,d=Fr(),e=Ar().parseId3Frames;return c=function(x){var y={},b=r(x,["moov","trak"]);return b.reduce(function(F,S){var w,A,C,I,T;return w=r(S,["tkhd"])[0],!w||(A=w[0],C=A===0?12:20,I=f(w[C]<<24|w[C+1]<<16|w[C+2]<<8|w[C+3]),T=r(S,["mdia","mdhd"])[0],!T)?null:(A=T[0],C=A===0?12:20,F[I]=f(T[C]<<24|T[C+1]<<16|T[C+2]<<8|T[C+3]),F)},y)},a=function(x,y){var b;b=r(y,["moof","traf"]);var F=b.reduce(function(S,w){var A=r(w,["tfhd"])[0],C=f(A[4]<<24|A[5]<<16|A[6]<<8|A[7]),I=x[C]||9e4,T=r(w,["tfdt"])[0],U=new DataView(T.buffer,T.byteOffset,T.byteLength),D;T[0]===1?D=g(T.subarray(4,12)):D=U.getUint32(4);var E;return typeof D=="bigint"?E=D/d.BigInt(I):typeof D=="number"&&!isNaN(D)&&(E=D/I),E<Number.MAX_SAFE_INTEGER&&(E=Number(E)),E<S&&(S=E),S},1/0);return typeof F=="bigint"||isFinite(F)?F:0},l=function(x,y){var b=r(y,["moof","traf"]),F=0,S=0,w;if(b&&b.length){var A=r(b[0],["tfhd"])[0],C=r(b[0],["trun"])[0],I=r(b[0],["tfdt"])[0];if(A){var T=m(A);w=T.trackId}if(I){var U=v(I);F=U.baseMediaDecodeTime}if(C){var D=_(C);D.samples&&D.samples.length&&(S=D.samples[0].compositionTimeOffset||0)}}var E=x[w]||9e4;typeof F=="bigint"&&(S=d.BigInt(S),E=d.BigInt(E));var R=(F+S)/E;return typeof R=="bigint"&&R<Number.MAX_SAFE_INTEGER&&(R=Number(R)),R},i=function(x){var y=r(x,["moov","trak"]),b=[];return y.forEach(function(F){var S=r(F,["mdia","hdlr"]),w=r(F,["tkhd"]);S.forEach(function(A,C){var I=p(A.subarray(8,12)),T=w[C],U,D,E;I==="vide"&&(U=new DataView(T.buffer,T.byteOffset,T.byteLength),D=U.getUint8(0),E=D===0?U.getUint32(12):U.getUint32(20),b.push(E))})}),b},u=function(x){var y=x[0],b=y===0?12:20;return f(x[b]<<24|x[b+1]<<16|x[b+2]<<8|x[b+3])},s=function(x){var y=r(x,["moov","trak"]),b=[];return y.forEach(function(F){var S={},w=r(F,["tkhd"])[0],A,C;w&&(A=new DataView(w.buffer,w.byteOffset,w.byteLength),C=A.getUint8(0),S.id=C===0?A.getUint32(12):A.getUint32(20));var I=r(F,["mdia","hdlr"])[0];if(I){var T=p(I.subarray(8,12));T==="vide"?S.type="video":T==="soun"?S.type="audio":S.type=T}var U=r(F,["mdia","minf","stbl","stsd"])[0];if(U){var D=U.subarray(8);S.codec=p(D.subarray(4,8));var E=r(D,[S.codec])[0],R,V;E&&(/^[asm]vc[1-9]$/i.test(S.codec)?(R=E.subarray(78),V=p(R.subarray(4,8)),V==="avcC"&&R.length>11?(S.codec+=".",S.codec+=t(R[9]),S.codec+=t(R[10]),S.codec+=t(R[11])):S.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(S.codec)?(R=E.subarray(28),V=p(R.subarray(4,8)),V==="esds"&&R.length>20&&R[19]!==0?(S.codec+="."+t(R[19]),S.codec+="."+t(R[20]>>>2&63).replace(/^0/,"")):S.codec="mp4a.40.2"):S.codec=S.codec.toLowerCase())}var H=r(F,["mdia","mdhd"])[0];H&&(S.timescale=u(H)),b.push(S)}),b},n=function(x,y){y===void 0&&(y=0);var b=r(x,["emsg"]);return b.map(function(F){var S=h.parseEmsgBox(new Uint8Array(F)),w=e(S.message_data);return{cueTime:h.scaleTime(S.presentation_time,S.timescale,S.presentation_time_delta,y),duration:h.scaleTime(S.event_duration,S.timescale),frames:w}})},je={findBox:r,parseType:p,timescale:c,startTime:a,compositionStartTime:l,videoTrackIds:i,tracks:s,getTimescaleFromMediaHeader:u,getEmsgID3:n},je}var Qe,Di;function Pr(){if(Di)return Qe;Di=1;var f=function(a){var l,i,s=[],u=[];for(u.byteLength=0,u.nalCount=0,u.duration=0,s.byteLength=0,l=0;l<a.length;l++)i=a[l],i.nalUnitType==="access_unit_delimiter_rbsp"?(s.length&&(s.duration=i.dts-s.dts,u.byteLength+=s.byteLength,u.nalCount+=s.length,u.duration+=s.duration,u.push(s)),s=[i],s.byteLength=i.data.byteLength,s.pts=i.pts,s.dts=i.dts):(i.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(s.keyFrame=!0),s.duration=i.dts-s.dts,s.byteLength+=i.data.byteLength,s.push(i));return u.length&&(!s.duration||s.duration<=0)&&(s.duration=u[u.length-1].duration),u.byteLength+=s.byteLength,u.nalCount+=s.length,u.duration+=s.duration,u.push(s),u},t=function(a){var l,i,s=[],u=[];for(s.byteLength=0,s.nalCount=0,s.duration=0,s.pts=a[0].pts,s.dts=a[0].dts,u.byteLength=0,u.nalCount=0,u.duration=0,u.pts=a[0].pts,u.dts=a[0].dts,l=0;l<a.length;l++)i=a[l],i.keyFrame?(s.length&&(u.push(s),u.byteLength+=s.byteLength,u.nalCount+=s.nalCount,u.duration+=s.duration),s=[i],s.nalCount=i.length,s.byteLength=i.byteLength,s.pts=i.pts,s.dts=i.dts,s.duration=i.duration):(s.duration+=i.duration,s.nalCount+=i.length,s.byteLength+=i.byteLength,s.push(i));return u.length&&s.duration<=0&&(s.duration=u[u.length-1].duration),u.byteLength+=s.byteLength,u.nalCount+=s.nalCount,u.duration+=s.duration,u.push(s),u},r=function(a){var l;return!a[0][0].keyFrame&&a.length>1&&(l=a.shift(),a.byteLength-=l.byteLength,a.nalCount-=l.nalCount,a[0][0].dts=l.dts,a[0][0].pts=l.pts,a[0][0].duration+=l.duration),a},p=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},h=function(a,l){var i=p();return i.dataOffset=l,i.compositionTimeOffset=a.pts-a.dts,i.duration=a.duration,i.size=4*a.length,i.size+=a.byteLength,a.keyFrame&&(i.flags.dependsOn=2,i.flags.isNonSyncSample=0),i},m=function(a,l){var i,s,u,n,d,e=l||0,o=[];for(i=0;i<a.length;i++)for(n=a[i],s=0;s<n.length;s++)d=n[s],u=h(d,e),e+=u.size,o.push(u);return o},_=function(a){var l,i,s,u,n,d,e=0,o=a.byteLength,x=a.nalCount,y=o+4*x,b=new Uint8Array(y),F=new DataView(b.buffer);for(l=0;l<a.length;l++)for(u=a[l],i=0;i<u.length;i++)for(n=u[i],s=0;s<n.length;s++)d=n[s],F.setUint32(e,d.data.byteLength),e+=4,b.set(d.data,e),e+=d.data.byteLength;return b},v=function(a,l){var i,s=l||0,u=[];return i=h(a,s),u.push(i),u},g=function(a){var l,i,s=0,u=a.byteLength,n=a.length,d=u+4*n,e=new Uint8Array(d),o=new DataView(e.buffer);for(l=0;l<a.length;l++)i=a[l],o.setUint32(s,i.data.byteLength),s+=4,e.set(i.data,s),s+=i.data.byteLength;return e};return Qe={groupNalsIntoFrames:f,groupFramesIntoGops:t,extendFirstKeyFrame:r,generateSampleTable:m,concatenateNalData:_,generateSampleTableForFrame:v,concatenateNalDataForFrame:g},Qe}var Ze,Ui;function rn(){if(Ui)return Ze;Ui=1;var f=[33,16,5,32,164,27],t=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],r=function(_){for(var v=[];_--;)v.push(0);return v},p=function(_){return Object.keys(_).reduce(function(v,g){return v[g]=new Uint8Array(_[g].reduce(function(c,a){return c.concat(a)},[])),v},{})},h;return Ze=function(){if(!h){var m={96e3:[f,[227,64],r(154),[56]],88200:[f,[231],r(170),[56]],64e3:[f,[248,192],r(240),[56]],48e3:[f,[255,192],r(268),[55,148,128],r(54),[112]],44100:[f,[255,192],r(268),[55,163,128],r(84),[112]],32e3:[f,[255,192],r(268),[55,234],r(226),[112]],24e3:[f,[255,192],r(268),[55,255,128],r(268),[111,112],r(126),[224]],16e3:[f,[255,192],r(268),[55,255,128],r(268),[111,255],r(269),[223,108],r(195),[1,192]],12e3:[t,r(268),[3,127,248],r(268),[6,255,240],r(268),[13,255,224],r(268),[27,253,128],r(259),[56]],11025:[t,r(268),[3,127,248],r(268),[6,255,240],r(268),[13,255,224],r(268),[27,255,192],r(268),[55,175,128],r(108),[112]],8e3:[t,r(268),[3,121,16],r(47),[7]]};h=p(m)}return h},Ze}var Je,Ii;function Dr(){if(Ii)return Je;Ii=1;var f=rn(),t=ie(),r=function(g){var c,a,l=0;for(c=0;c<g.length;c++)a=g[c],l+=a.data.byteLength;return l},p=function(g,c,a,l){var i,s=0,u=0,n=0,d=0,e,o,x;if(c.length&&(i=t.audioTsToVideoTs(g.baseMediaDecodeTime,g.samplerate),s=Math.ceil(t.ONE_SECOND_IN_TS/(g.samplerate/1024)),a&&l&&(u=i-Math.max(a,l),n=Math.floor(u/s),d=n*s),!(n<1||d>t.ONE_SECOND_IN_TS/2))){for(e=f()[g.samplerate],e||(e=c[0].data),o=0;o<n;o++)x=c[0],c.splice(0,0,{data:e,dts:x.dts-s,pts:x.pts-s});return g.baseMediaDecodeTime-=Math.floor(t.videoTsToAudioTs(d,g.samplerate)),d}},h=function(g,c,a){return c.minSegmentDts>=a?g:(c.minSegmentDts=1/0,g.filter(function(l){return l.dts>=a?(c.minSegmentDts=Math.min(c.minSegmentDts,l.dts),c.minSegmentPts=c.minSegmentDts,!0):!1}))},m=function(g){var c,a,l=[];for(c=0;c<g.length;c++)a=g[c],l.push({size:a.data.byteLength,duration:1024});return l},_=function(g){var c,a,l=0,i=new Uint8Array(r(g));for(c=0;c<g.length;c++)a=g[c],i.set(a.data,l),l+=a.data.byteLength;return i};return Je={prefixWithSilence:p,trimAdtsFramesByEarliestDts:h,generateSampleTable:m,concatenateFrameData:_},Je}var et,Ci;function be(){if(Ci)return et;Ci=1;var f=ie().ONE_SECOND_IN_TS,t=function(m,_){typeof _.pts=="number"&&(m.timelineStartInfo.pts===void 0&&(m.timelineStartInfo.pts=_.pts),m.minSegmentPts===void 0?m.minSegmentPts=_.pts:m.minSegmentPts=Math.min(m.minSegmentPts,_.pts),m.maxSegmentPts===void 0?m.maxSegmentPts=_.pts:m.maxSegmentPts=Math.max(m.maxSegmentPts,_.pts)),typeof _.dts=="number"&&(m.timelineStartInfo.dts===void 0&&(m.timelineStartInfo.dts=_.dts),m.minSegmentDts===void 0?m.minSegmentDts=_.dts:m.minSegmentDts=Math.min(m.minSegmentDts,_.dts),m.maxSegmentDts===void 0?m.maxSegmentDts=_.dts:m.maxSegmentDts=Math.max(m.maxSegmentDts,_.dts))},r=function(m){delete m.minSegmentDts,delete m.maxSegmentDts,delete m.minSegmentPts,delete m.maxSegmentPts},p=function(m,_){var v,g,c=m.minSegmentDts;return _||(c-=m.timelineStartInfo.dts),v=m.timelineStartInfo.baseMediaDecodeTime,v+=c,v=Math.max(0,v),m.type==="audio"&&(g=m.samplerate/f,v*=g,v=Math.floor(v)),v};return et={clearDtsInfo:r,calculateTrackBaseMediaDecodeTime:p,collectDtsInfo:t},et}var tt,Ei;function Ur(){if(Ei)return tt;Ei=1;var f=4,t=128,r=function(v){for(var g=0,c={payloadType:-1,payloadSize:0},a=0,l=0;g<v.byteLength&&v[g]!==t;){for(;v[g]===255;)a+=255,g++;for(a+=v[g++];v[g]===255;)l+=255,g++;if(l+=v[g++],!c.payload&&a===f){var i=String.fromCharCode(v[g+3],v[g+4],v[g+5],v[g+6]);if(i==="GA94"){c.payloadType=a,c.payloadSize=l,c.payload=v.subarray(g,g+l);break}else c.payload=void 0}g+=l,a=0,l=0}return c},p=function(v){return v.payload[0]!==181||(v.payload[1]<<8|v.payload[2])!==49||String.fromCharCode(v.payload[3],v.payload[4],v.payload[5],v.payload[6])!=="GA94"||v.payload[7]!==3?null:v.payload.subarray(8,v.payload.length-1)},h=function(v,g){var c=[],a,l,i,s;if(!(g[0]&64))return c;for(l=g[0]&31,a=0;a<l;a++)i=a*3,s={type:g[i+2]&3,pts:v},g[i+2]&4&&(s.ccData=g[i+3]<<8|g[i+4],c.push(s));return c},m=function(v){for(var g=v.byteLength,c=[],a=1,l,i;a<g-2;)v[a]===0&&v[a+1]===0&&v[a+2]===3?(c.push(a+2),a+=2):a++;if(c.length===0)return v;l=g-c.length,i=new Uint8Array(l);var s=0;for(a=0;a<l;s++,a++)s===c[0]&&(s++,c.shift()),i[a]=v[s];return i};return tt={parseSei:r,parseUserData:p,parseCaptionPackets:h,discardEmulationPreventionBytes:m,USER_DATA_REGISTERED_ITU_T_T35:f},tt}var it,Ri;function Ir(){if(Ri)return it;Ri=1;var f=ee(),t=Ur(),r=function n(d){d=d||{},n.prototype.init.call(this),this.parse708captions_=typeof d.parse708captions=="boolean"?d.parse708captions:!0,this.captionPackets_=[],this.ccStreams_=[new u(0,0),new u(0,1),new u(1,0),new u(1,1)],this.parse708captions_&&(this.cc708Stream_=new g({captionServices:d.captionServices})),this.reset(),this.ccStreams_.forEach(function(e){e.on("data",this.trigger.bind(this,"data")),e.on("partialdone",this.trigger.bind(this,"partialdone")),e.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};r.prototype=new f,r.prototype.push=function(n){var d,e,o;if(n.nalUnitType==="sei_rbsp"&&(d=t.parseSei(n.escapedRBSP),!!d.payload&&d.payloadType===t.USER_DATA_REGISTERED_ITU_T_T35&&(e=t.parseUserData(d),!!e))){if(n.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(n.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--,this.numSameDts_||(this.ignoreNextEqualDts_=!1);return}o=t.parseCaptionPackets(n.pts,e),this.captionPackets_=this.captionPackets_.concat(o),this.latestDts_!==n.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=n.dts}},r.prototype.flushCCStreams=function(n){this.ccStreams_.forEach(function(d){return n==="flush"?d.flush():d.partialFlush()},this)},r.prototype.flushStream=function(n){if(!this.captionPackets_.length){this.flushCCStreams(n);return}this.captionPackets_.forEach(function(d,e){d.presortIndex=e}),this.captionPackets_.sort(function(d,e){return d.pts===e.pts?d.presortIndex-e.presortIndex:d.pts-e.pts}),this.captionPackets_.forEach(function(d){d.type<2?this.dispatchCea608Packet(d):this.dispatchCea708Packet(d)},this),this.captionPackets_.length=0,this.flushCCStreams(n)},r.prototype.flush=function(){return this.flushStream("flush")},r.prototype.partialFlush=function(){return this.flushStream("partialFlush")},r.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(n){n.reset()})},r.prototype.dispatchCea608Packet=function(n){this.setsTextOrXDSActive(n)?this.activeCea608Channel_[n.type]=null:this.setsChannel1Active(n)?this.activeCea608Channel_[n.type]=0:this.setsChannel2Active(n)&&(this.activeCea608Channel_[n.type]=1),this.activeCea608Channel_[n.type]!==null&&this.ccStreams_[(n.type<<1)+this.activeCea608Channel_[n.type]].push(n)},r.prototype.setsChannel1Active=function(n){return(n.ccData&30720)===4096},r.prototype.setsChannel2Active=function(n){return(n.ccData&30720)===6144},r.prototype.setsTextOrXDSActive=function(n){return(n.ccData&28928)===256||(n.ccData&30974)===4138||(n.ccData&30974)===6186},r.prototype.dispatchCea708Packet=function(n){this.parse708captions_&&this.cc708Stream_.push(n)};var p={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},h=function(d){var e=p[d]||d;return d&4096&&d===e?"":String.fromCharCode(e)},m=function(d){return 32<=d&&d<=127||160<=d&&d<=255},_=function(d){this.windowNum=d,this.reset()};_.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},_.prototype.getText=function(){return this.rows.join(`
`)},_.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},_.prototype.newLine=function(n){for(this.rows.length>=this.virtualRowCount&&typeof this.beforeRowOverflow=="function"&&this.beforeRowOverflow(n),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},_.prototype.isEmpty=function(){return this.rows.length===0?!0:this.rows.length===1?this.rows[0]==="":!1},_.prototype.addText=function(n){this.rows[this.rowIdx]+=n},_.prototype.backspace=function(){if(!this.isEmpty()){var n=this.rows[this.rowIdx];this.rows[this.rowIdx]=n.substr(0,n.length-1)}};var v=function(d,e,o){this.serviceNum=d,this.text="",this.currentWindow=new _(-1),this.windows=[],this.stream=o,typeof e=="string"&&this.createTextDecoder(e)};v.prototype.init=function(n,d){this.startPts=n;for(var e=0;e<8;e++)this.windows[e]=new _(e),typeof d=="function"&&(this.windows[e].beforeRowOverflow=d)},v.prototype.setCurrentWindow=function(n){this.currentWindow=this.windows[n]},v.prototype.createTextDecoder=function(n){if(typeof TextDecoder>"u")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(n)}catch(d){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+n+" encoding. "+d})}};var g=function n(d){d=d||{},n.prototype.init.call(this);var e=this,o=d.captionServices||{},x={},y;Object.keys(o).forEach(function(b){y=o[b],/^SERVICE/.test(b)&&(x[b]=y.encoding)}),this.serviceEncodings=x,this.current708Packet=null,this.services={},this.push=function(b){b.type===3?(e.new708Packet(),e.add708Bytes(b)):(e.current708Packet===null&&e.new708Packet(),e.add708Bytes(b))}};g.prototype=new f,g.prototype.new708Packet=function(){this.current708Packet!==null&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},g.prototype.add708Bytes=function(n){var d=n.ccData,e=d>>>8,o=d&255;this.current708Packet.ptsVals.push(n.pts),this.current708Packet.data.push(e),this.current708Packet.data.push(o)},g.prototype.push708Packet=function(){var n=this.current708Packet,d=n.data,e=null,o=null,x=0,y=d[x++];for(n.seq=y>>6,n.sizeCode=y&63;x<d.length;x++)y=d[x++],e=y>>5,o=y&31,e===7&&o>0&&(y=d[x++],e=y),this.pushServiceBlock(e,x,o),o>0&&(x+=o-1)},g.prototype.pushServiceBlock=function(n,d,e){var o,x=d,y=this.current708Packet.data,b=this.services[n];for(b||(b=this.initService(n,x));x<d+e&&x<y.length;x++)o=y[x],m(o)?x=this.handleText(x,b):o===24?x=this.multiByteCharacter(x,b):o===16?x=this.extendedCommands(x,b):128<=o&&o<=135?x=this.setCurrentWindow(x,b):152<=o&&o<=159?x=this.defineWindow(x,b):o===136?x=this.clearWindows(x,b):o===140?x=this.deleteWindows(x,b):o===137?x=this.displayWindows(x,b):o===138?x=this.hideWindows(x,b):o===139?x=this.toggleWindows(x,b):o===151?x=this.setWindowAttributes(x,b):o===144?x=this.setPenAttributes(x,b):o===145?x=this.setPenColor(x,b):o===146?x=this.setPenLocation(x,b):o===143?b=this.reset(x,b):o===8?b.currentWindow.backspace():o===12?b.currentWindow.clearText():o===13?b.currentWindow.pendingNewLine=!0:o===14?b.currentWindow.clearText():o===141&&x++},g.prototype.extendedCommands=function(n,d){var e=this.current708Packet.data,o=e[++n];return m(o)&&(n=this.handleText(n,d,{isExtended:!0})),n},g.prototype.getPts=function(n){return this.current708Packet.ptsVals[Math.floor(n/2)]},g.prototype.initService=function(n,d){var o="SERVICE"+n,e=this,o,x;return o in this.serviceEncodings&&(x=this.serviceEncodings[o]),this.services[n]=new v(n,x,e),this.services[n].init(this.getPts(d),function(y){e.flushDisplayed(y,e.services[n])}),this.services[n]},g.prototype.handleText=function(n,d,e){var o=e&&e.isExtended,x=e&&e.isMultiByte,y=this.current708Packet.data,b=o?4096:0,F=y[n],S=y[n+1],w=d.currentWindow,A,C;return d.textDecoder_&&!o?(x?(C=[F,S],n++):C=[F],A=d.textDecoder_.decode(new Uint8Array(C))):A=h(b|F),w.pendingNewLine&&!w.isEmpty()&&w.newLine(this.getPts(n)),w.pendingNewLine=!1,w.addText(A),n},g.prototype.multiByteCharacter=function(n,d){var e=this.current708Packet.data,o=e[n+1],x=e[n+2];return m(o)&&m(x)&&(n=this.handleText(++n,d,{isMultiByte:!0})),n},g.prototype.setCurrentWindow=function(n,d){var e=this.current708Packet.data,o=e[n],x=o&7;return d.setCurrentWindow(x),n},g.prototype.defineWindow=function(n,d){var e=this.current708Packet.data,o=e[n],x=o&7;d.setCurrentWindow(x);var y=d.currentWindow;return o=e[++n],y.visible=(o&32)>>5,y.rowLock=(o&16)>>4,y.columnLock=(o&8)>>3,y.priority=o&7,o=e[++n],y.relativePositioning=(o&128)>>7,y.anchorVertical=o&127,o=e[++n],y.anchorHorizontal=o,o=e[++n],y.anchorPoint=(o&240)>>4,y.rowCount=o&15,o=e[++n],y.columnCount=o&63,o=e[++n],y.windowStyle=(o&56)>>3,y.penStyle=o&7,y.virtualRowCount=y.rowCount+1,n},g.prototype.setWindowAttributes=function(n,d){var e=this.current708Packet.data,o=e[n],x=d.currentWindow.winAttr;return o=e[++n],x.fillOpacity=(o&192)>>6,x.fillRed=(o&48)>>4,x.fillGreen=(o&12)>>2,x.fillBlue=o&3,o=e[++n],x.borderType=(o&192)>>6,x.borderRed=(o&48)>>4,x.borderGreen=(o&12)>>2,x.borderBlue=o&3,o=e[++n],x.borderType+=(o&128)>>5,x.wordWrap=(o&64)>>6,x.printDirection=(o&48)>>4,x.scrollDirection=(o&12)>>2,x.justify=o&3,o=e[++n],x.effectSpeed=(o&240)>>4,x.effectDirection=(o&12)>>2,x.displayEffect=o&3,n},g.prototype.flushDisplayed=function(n,d){for(var e=[],o=0;o<8;o++)d.windows[o].visible&&!d.windows[o].isEmpty()&&e.push(d.windows[o].getText());d.endPts=n,d.text=e.join(`

`),this.pushCaption(d),d.startPts=n},g.prototype.pushCaption=function(n){n.text!==""&&(this.trigger("data",{startPts:n.startPts,endPts:n.endPts,text:n.text,stream:"cc708_"+n.serviceNum}),n.text="",n.startPts=n.endPts)},g.prototype.displayWindows=function(n,d){var e=this.current708Packet.data,o=e[++n],x=this.getPts(n);this.flushDisplayed(x,d);for(var y=0;y<8;y++)o&1<<y&&(d.windows[y].visible=1);return n},g.prototype.hideWindows=function(n,d){var e=this.current708Packet.data,o=e[++n],x=this.getPts(n);this.flushDisplayed(x,d);for(var y=0;y<8;y++)o&1<<y&&(d.windows[y].visible=0);return n},g.prototype.toggleWindows=function(n,d){var e=this.current708Packet.data,o=e[++n],x=this.getPts(n);this.flushDisplayed(x,d);for(var y=0;y<8;y++)o&1<<y&&(d.windows[y].visible^=1);return n},g.prototype.clearWindows=function(n,d){var e=this.current708Packet.data,o=e[++n],x=this.getPts(n);this.flushDisplayed(x,d);for(var y=0;y<8;y++)o&1<<y&&d.windows[y].clearText();return n},g.prototype.deleteWindows=function(n,d){var e=this.current708Packet.data,o=e[++n],x=this.getPts(n);this.flushDisplayed(x,d);for(var y=0;y<8;y++)o&1<<y&&d.windows[y].reset();return n},g.prototype.setPenAttributes=function(n,d){var e=this.current708Packet.data,o=e[n],x=d.currentWindow.penAttr;return o=e[++n],x.textTag=(o&240)>>4,x.offset=(o&12)>>2,x.penSize=o&3,o=e[++n],x.italics=(o&128)>>7,x.underline=(o&64)>>6,x.edgeType=(o&56)>>3,x.fontStyle=o&7,n},g.prototype.setPenColor=function(n,d){var e=this.current708Packet.data,o=e[n],x=d.currentWindow.penColor;return o=e[++n],x.fgOpacity=(o&192)>>6,x.fgRed=(o&48)>>4,x.fgGreen=(o&12)>>2,x.fgBlue=o&3,o=e[++n],x.bgOpacity=(o&192)>>6,x.bgRed=(o&48)>>4,x.bgGreen=(o&12)>>2,x.bgBlue=o&3,o=e[++n],x.edgeRed=(o&48)>>4,x.edgeGreen=(o&12)>>2,x.edgeBlue=o&3,n},g.prototype.setPenLocation=function(n,d){var e=this.current708Packet.data,o=e[n],x=d.currentWindow.penLoc;return d.currentWindow.pendingNewLine=!0,o=e[++n],x.row=o&15,o=e[++n],x.column=o&63,n},g.prototype.reset=function(n,d){var e=this.getPts(n);return this.flushDisplayed(e,d),this.initService(d.serviceNum,n)};var c={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},a=function(d){return d===null?"":(d=c[d]||d,String.fromCharCode(d))},l=14,i=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],s=function(){for(var d=[],e=l+1;e--;)d.push("");return d},u=function n(d,e){n.prototype.init.call(this),this.field_=d||0,this.dataChannel_=e||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(o){var x,y,b,F,S;if(x=o.ccData&32639,x===this.lastControlCode_){this.lastControlCode_=null;return}if((x&61440)===4096?this.lastControlCode_=x:x!==this.PADDING_&&(this.lastControlCode_=null),b=x>>>8,F=x&255,x!==this.PADDING_)if(x===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(x===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(o.pts),this.flushDisplayed(o.pts),y=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=y,this.startPts_=o.pts;else if(x===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(o.pts);else if(x===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(o.pts);else if(x===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(o.pts);else if(x===this.CARRIAGE_RETURN_)this.clearFormatting(o.pts),this.flushDisplayed(o.pts),this.shiftRowsUp_(),this.startPts_=o.pts;else if(x===this.BACKSPACE_)this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(x===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(o.pts),this.displayed_=s();else if(x===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=s();else if(x===this.RESUME_DIRECT_CAPTIONING_)this.mode_!=="paintOn"&&(this.flushDisplayed(o.pts),this.displayed_=s()),this.mode_="paintOn",this.startPts_=o.pts;else if(this.isSpecialCharacter(b,F))b=(b&3)<<8,S=a(b|F),this[this.mode_](o.pts,S),this.column_++;else if(this.isExtCharacter(b,F))this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),b=(b&3)<<8,S=a(b|F),this[this.mode_](o.pts,S),this.column_++;else if(this.isMidRowCode(b,F))this.clearFormatting(o.pts),this[this.mode_](o.pts," "),this.column_++,(F&14)===14&&this.addFormatting(o.pts,["i"]),(F&1)===1&&this.addFormatting(o.pts,["u"]);else if(this.isOffsetControlCode(b,F))this.column_+=F&3;else if(this.isPAC(b,F)){var w=i.indexOf(x&7968);this.mode_==="rollUp"&&(w-this.rollUpRows_+1<0&&(w=this.rollUpRows_-1),this.setRollUp(o.pts,w)),w!==this.row_&&(this.clearFormatting(o.pts),this.row_=w),F&1&&this.formatting_.indexOf("u")===-1&&this.addFormatting(o.pts,["u"]),(x&16)===16&&(this.column_=((x&14)>>1)*4),this.isColorPAC(F)&&(F&14)===14&&this.addFormatting(o.pts,["i"])}else this.isNormalChar(b)&&(F===0&&(F=null),S=a(b),S+=a(F),this[this.mode_](o.pts,S),this.column_+=S.length)}};return u.prototype=new f,u.prototype.flushDisplayed=function(n){var d=this.displayed_.map(function(e,o){try{return e.trim()}catch{return this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+o+"."}),""}},this).join(`
`).replace(/^\n+|\n+$/g,"");d.length&&this.trigger("data",{startPts:this.startPts_,endPts:n,text:d,stream:this.name_})},u.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=s(),this.nonDisplayed_=s(),this.lastControlCode_=null,this.column_=0,this.row_=l,this.rollUpRows_=2,this.formatting_=[]},u.prototype.setConstants=function(){this.dataChannel_===0?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):this.dataChannel_===1&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=this.CONTROL_|32,this.END_OF_CAPTION_=this.CONTROL_|47,this.ROLL_UP_2_ROWS_=this.CONTROL_|37,this.ROLL_UP_3_ROWS_=this.CONTROL_|38,this.ROLL_UP_4_ROWS_=this.CONTROL_|39,this.CARRIAGE_RETURN_=this.CONTROL_|45,this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41,this.BACKSPACE_=this.CONTROL_|33,this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44,this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46},u.prototype.isSpecialCharacter=function(n,d){return n===this.EXT_&&d>=48&&d<=63},u.prototype.isExtCharacter=function(n,d){return(n===this.EXT_+1||n===this.EXT_+2)&&d>=32&&d<=63},u.prototype.isMidRowCode=function(n,d){return n===this.EXT_&&d>=32&&d<=47},u.prototype.isOffsetControlCode=function(n,d){return n===this.OFFSET_&&d>=33&&d<=35},u.prototype.isPAC=function(n,d){return n>=this.BASE_&&n<this.BASE_+8&&d>=64&&d<=127},u.prototype.isColorPAC=function(n){return n>=64&&n<=79||n>=96&&n<=127},u.prototype.isNormalChar=function(n){return n>=32&&n<=127},u.prototype.setRollUp=function(n,d){if(this.mode_!=="rollUp"&&(this.row_=l,this.mode_="rollUp",this.flushDisplayed(n),this.nonDisplayed_=s(),this.displayed_=s()),d!==void 0&&d!==this.row_)for(var e=0;e<this.rollUpRows_;e++)this.displayed_[d-e]=this.displayed_[this.row_-e],this.displayed_[this.row_-e]="";d===void 0&&(d=this.row_),this.topRow_=d-this.rollUpRows_+1},u.prototype.addFormatting=function(n,d){this.formatting_=this.formatting_.concat(d);var e=d.reduce(function(o,x){return o+"<"+x+">"},"");this[this.mode_](n,e)},u.prototype.clearFormatting=function(n){if(this.formatting_.length){var d=this.formatting_.reverse().reduce(function(e,o){return e+"</"+o+">"},"");this.formatting_=[],this[this.mode_](n,d)}},u.prototype.popOn=function(n,d){var e=this.nonDisplayed_[this.row_];e+=d,this.nonDisplayed_[this.row_]=e},u.prototype.rollUp=function(n,d){var e=this.displayed_[this.row_];e+=d,this.displayed_[this.row_]=e},u.prototype.shiftRowsUp_=function(){var n;for(n=0;n<this.topRow_;n++)this.displayed_[n]="";for(n=this.row_+1;n<l+1;n++)this.displayed_[n]="";for(n=this.topRow_;n<this.row_;n++)this.displayed_[n]=this.displayed_[n+1];this.displayed_[this.row_]=""},u.prototype.paintOn=function(n,d){var e=this.displayed_[this.row_];e+=d,this.displayed_[this.row_]=e},it={CaptionStream:r,Cea608Stream:u,Cea708Stream:g},it}var rt,Li;function Te(){return Li||(Li=1,rt={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21}),rt}var nt,Mi;function Cr(){if(Mi)return nt;Mi=1;var f=ee(),t=8589934592,r=4294967296,p="shared",h=function(v,g){var c=1;for(v>g&&(c=-1);Math.abs(g-v)>r;)v+=c*t;return v},m=function _(v){var g,c;_.prototype.init.call(this),this.type_=v||p,this.push=function(a){this.type_!==p&&a.type!==this.type_||(c===void 0&&(c=a.dts),a.dts=h(a.dts,c),a.pts=h(a.pts,c),g=a.dts,this.trigger("data",a))},this.flush=function(){c=g,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){c=void 0,g=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};return m.prototype=new f,nt={TimestampRolloverStream:m,handleRollover:h},nt}var at,Oi;function nn(){if(Oi)return at;Oi=1;var f=ee(),t=Te(),r=Ar(),p;return p=function(m){var _={descriptor:m&&m.descriptor},v=0,g=[],c=0,a;if(p.prototype.init.call(this),this.dispatchType=t.METADATA_STREAM_TYPE.toString(16),_.descriptor)for(a=0;a<_.descriptor.length;a++)this.dispatchType+=("00"+_.descriptor[a].toString(16)).slice(-2);this.push=function(l){var i,s,u,n,d,e;if(l.type==="timed-metadata"){if(l.dataAlignmentIndicator&&(c=0,g.length=0),g.length===0&&(l.data.length<10||l.data[0]!==73||l.data[1]!==68||l.data[2]!==51)){this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});return}if(g.push(l),c+=l.data.byteLength,g.length===1&&(v=r.parseSyncSafeInteger(l.data.subarray(6,10)),v+=10),!(c<v)){for(i={data:new Uint8Array(v),frames:[],pts:g[0].pts,dts:g[0].dts},d=0;d<v;)i.data.set(g[0].data.subarray(0,v-d),d),d+=g[0].data.byteLength,c-=g[0].data.byteLength,g.shift();s=10,i.data[5]&64&&(s+=4,s+=r.parseSyncSafeInteger(i.data.subarray(10,14)),v-=r.parseSyncSafeInteger(i.data.subarray(16,20)));do{if(u=r.parseSyncSafeInteger(i.data.subarray(s+4,s+8)),u<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping remaining metadata parsing."});break}if(e=String.fromCharCode(i.data[s],i.data[s+1],i.data[s+2],i.data[s+3]),n={id:e,data:i.data.subarray(s+10,s+u+10)},n.key=n.id,r.frameParsers[n.id]?r.frameParsers[n.id](n):n.id[0]==="T"?r.frameParsers["T*"](n):n.id[0]==="W"&&r.frameParsers["W*"](n),n.owner==="com.apple.streaming.transportStreamTimestamp"){var o=n.data,x=(o[3]&1)<<30|o[4]<<22|o[5]<<14|o[6]<<6|o[7]>>>2;x*=4,x+=o[7]&3,n.timeStamp=x,i.pts===void 0&&i.dts===void 0&&(i.pts=n.timeStamp,i.dts=n.timeStamp),this.trigger("timestamp",n)}i.frames.push(n),s+=10,s+=u}while(s<v);this.trigger("data",i)}}}},p.prototype=new f,at=p,at}var st,Bi;function we(){if(Bi)return st;Bi=1;var f=ee(),t=Ir(),r=Te(),p=Cr().TimestampRolloverStream,h,m,_,v=188,g=71;h=function(){var i=new Uint8Array(v),s=0;h.prototype.init.call(this),this.push=function(u){var n=0,d=v,e;for(s?(e=new Uint8Array(u.byteLength+s),e.set(i.subarray(0,s)),e.set(u,s),s=0):e=u;d<e.byteLength;){if(e[n]===g&&e[d]===g){this.trigger("data",e.subarray(n,d)),n+=v,d+=v;continue}n++,d++}n<e.byteLength&&(i.set(e.subarray(n),0),s=e.byteLength-n)},this.flush=function(){s===v&&i[0]===g&&(this.trigger("data",i),s=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){s=0,this.trigger("reset")}},h.prototype=new f,m=function(){var i,s,u,n;m.prototype.init.call(this),n=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,i=function(e,o){var x=0;o.payloadUnitStartIndicator&&(x+=e[x]+1),o.type==="pat"?s(e.subarray(x),o):u(e.subarray(x),o)},s=function(e,o){o.section_number=e[7],o.last_section_number=e[8],n.pmtPid=(e[10]&31)<<8|e[11],o.pmtPid=n.pmtPid},u=function(e,o){var x,y,b,F;if(e[5]&1){for(n.programMapTable={video:null,audio:null,"timed-metadata":{}},x=(e[1]&15)<<8|e[2],y=3+x-4,b=(e[10]&15)<<8|e[11],F=12+b;F<y;){var S=e[F],w=(e[F+1]&31)<<8|e[F+2];S===r.H264_STREAM_TYPE&&n.programMapTable.video===null?n.programMapTable.video=w:S===r.ADTS_STREAM_TYPE&&n.programMapTable.audio===null?n.programMapTable.audio=w:S===r.METADATA_STREAM_TYPE&&(n.programMapTable["timed-metadata"][w]=S),F+=((e[F+3]&15)<<8|e[F+4])+5}o.programMapTable=n.programMapTable}},this.push=function(d){var e={},o=4;if(e.payloadUnitStartIndicator=!!(d[1]&64),e.pid=d[1]&31,e.pid<<=8,e.pid|=d[2],(d[3]&48)>>>4>1&&(o+=d[o]+1),e.pid===0)e.type="pat",i(d.subarray(o),e),this.trigger("data",e);else if(e.pid===this.pmtPid)for(e.type="pmt",i(d.subarray(o),e),this.trigger("data",e);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else this.programMapTable===void 0?this.packetsWaitingForPmt.push([d,o,e]):this.processPes_(d,o,e)},this.processPes_=function(d,e,o){o.pid===this.programMapTable.video?o.streamType=r.H264_STREAM_TYPE:o.pid===this.programMapTable.audio?o.streamType=r.ADTS_STREAM_TYPE:o.streamType=this.programMapTable["timed-metadata"][o.pid],o.type="pes",o.data=d.subarray(e),this.trigger("data",o)}},m.prototype=new f,m.STREAM_TYPES={h264:27,adts:15},_=function(){var i=this,s=!1,u={data:[],size:0},n={data:[],size:0},d={data:[],size:0},e,o=function(b,F){var S,w=b[0]<<16|b[1]<<8|b[2];F.data=new Uint8Array,w===1&&(F.packetLength=6+(b[4]<<8|b[5]),F.dataAlignmentIndicator=(b[6]&4)!==0,S=b[7],S&192&&(F.pts=(b[9]&14)<<27|(b[10]&255)<<20|(b[11]&254)<<12|(b[12]&255)<<5|(b[13]&254)>>>3,F.pts*=4,F.pts+=(b[13]&6)>>>1,F.dts=F.pts,S&64&&(F.dts=(b[14]&14)<<27|(b[15]&255)<<20|(b[16]&254)<<12|(b[17]&255)<<5|(b[18]&254)>>>3,F.dts*=4,F.dts+=(b[18]&6)>>>1)),F.data=b.subarray(9+b[8]))},x=function(b,F,S){var w=new Uint8Array(b.size),A={type:F},C=0,I=0,T=!1,U;if(!(!b.data.length||b.size<9)){for(A.trackId=b.data[0].pid,C=0;C<b.data.length;C++)U=b.data[C],w.set(U.data,I),I+=U.data.byteLength;o(w,A),T=F==="video"||A.packetLength<=b.size,(S||T)&&(b.size=0,b.data.length=0),T&&i.trigger("data",A)}};_.prototype.init.call(this),this.push=function(y){({pat:function(){},pes:function(){var F,S;switch(y.streamType){case r.H264_STREAM_TYPE:F=u,S="video";break;case r.ADTS_STREAM_TYPE:F=n,S="audio";break;case r.METADATA_STREAM_TYPE:F=d,S="timed-metadata";break;default:return}y.payloadUnitStartIndicator&&x(F,S,!0),F.data.push(y),F.size+=y.data.byteLength},pmt:function(){var F={type:"metadata",tracks:[]};e=y.programMapTable,e.video!==null&&F.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),e.audio!==null&&F.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),s=!0,i.trigger("data",F)}})[y.type]()},this.reset=function(){u.size=0,u.data.length=0,n.size=0,n.data.length=0,this.trigger("reset")},this.flushStreams_=function(){x(u,"video"),x(n,"audio"),x(d,"timed-metadata")},this.flush=function(){if(!s&&e){var y={type:"metadata",tracks:[]};e.video!==null&&y.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),e.audio!==null&&y.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),i.trigger("data",y)}s=!1,this.flushStreams_(),this.trigger("done")}},_.prototype=new f;var c={PAT_PID:0,MP2T_PACKET_LENGTH:v,TransportPacketStream:h,TransportParseStream:m,ElementaryStream:_,TimestampRolloverStream:p,CaptionStream:t.CaptionStream,Cea608Stream:t.Cea608Stream,Cea708Stream:t.Cea708Stream,MetadataStream:nn()};for(var a in r)r.hasOwnProperty(a)&&(c[a]=r[a]);return st=c,st}var ot,ki;function Fe(){if(ki)return ot;ki=1;var f=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],t=function(i,s){var u=i[s+6]<<21|i[s+7]<<14|i[s+8]<<7|i[s+9],n=i[s+5],d=(n&16)>>4;return u=u>=0?u:0,d?u+20:u+10},r=function l(i,s){return i.length-s<10||i[s]!==73||i[s+1]!==68||i[s+2]!==51?s:(s+=t(i,s),l(i,s))},p=function(i){var s=r(i,0);return i.length>=s+2&&(i[s]&255)===255&&(i[s+1]&240)===240&&(i[s+1]&22)===16},h=function(i){return i[0]<<21|i[1]<<14|i[2]<<7|i[3]},m=function(i,s,u){var n,d="";for(n=s;n<u;n++)d+="%"+("00"+i[n].toString(16)).slice(-2);return d},_=function(i,s,u){return unescape(m(i,s,u))},v=function(i,s){var u=(i[s+5]&224)>>5,n=i[s+4]<<3,d=i[s+3]&6144;return d|n|u},g=function(i,s){return i[s]===73&&i[s+1]===68&&i[s+2]===51?"timed-metadata":i[s]&!0&&(i[s+1]&240)===240?"audio":null},c=function(i){for(var s=0;s+5<i.length;){if(i[s]!==255||(i[s+1]&246)!==240){s++;continue}return f[(i[s+2]&60)>>>2]}return null},a=function(i){var s,u,n,d;s=10,i[5]&64&&(s+=4,s+=h(i.subarray(10,14)));do{if(u=h(i.subarray(s+4,s+8)),u<1)return null;if(d=String.fromCharCode(i[s],i[s+1],i[s+2],i[s+3]),d==="PRIV"){n=i.subarray(s+10,s+u+10);for(var e=0;e<n.byteLength;e++)if(n[e]===0){var o=_(n,0,e);if(o==="com.apple.streaming.transportStreamTimestamp"){var x=n.subarray(e+1),y=(x[3]&1)<<30|x[4]<<22|x[5]<<14|x[6]<<6|x[7]>>>2;return y*=4,y+=x[7]&3,y}break}}s+=10,s+=u}while(s<i.byteLength);return null};return ot={isLikelyAacData:p,parseId3TagSize:t,parseAdtsSize:v,parseType:g,parseSampleRate:c,parseAacTimestamp:a},ot}var ut,Ni;function Er(){if(Ni)return ut;Ni=1;var f=ee(),t=Fe(),r;return r=function(){var h=new Uint8Array,m=0;r.prototype.init.call(this),this.setTimestamp=function(_){m=_},this.push=function(_){var v=0,g=0,c,a,l,i;for(h.length?(i=h.length,h=new Uint8Array(_.byteLength+i),h.set(h.subarray(0,i)),h.set(_,i)):h=_;h.length-g>=3;){if(h[g]===73&&h[g+1]===68&&h[g+2]===51){if(h.length-g<10||(v=t.parseId3TagSize(h,g),g+v>h.length))break;a={type:"timed-metadata",data:h.subarray(g,g+v)},this.trigger("data",a),g+=v;continue}else if((h[g]&255)===255&&(h[g+1]&240)===240){if(h.length-g<7||(v=t.parseAdtsSize(h,g),g+v>h.length))break;l={type:"audio",data:h.subarray(g,g+v),pts:m,dts:m},this.trigger("data",l),g+=v;continue}g++}c=h.length-g,c>0?h=h.subarray(g):h=new Uint8Array},this.reset=function(){h=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){h=new Uint8Array,this.trigger("endedtimeline")}},r.prototype=new f,ut=r,ut}var lt,qi;function Rr(){if(qi)return lt;qi=1;var f=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"];return lt=f,lt}var dt,Vi;function Lr(){if(Vi)return dt;Vi=1;var f=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"];return dt=f,dt}var ft,zi;function ht(){if(zi)return ft;zi=1;var f=ee(),t=Se(),r=Pr(),p=Dr(),h=be(),m=we(),_=ie(),v=ye(),g=qt().H264Stream,c=Er(),a=Fe().isLikelyAacData,l=ie().ONE_SECOND_IN_TS,i=Rr(),s=Lr(),u,n,d,e,o=function(S,w){w.stream=S,this.trigger("log",w)},x=function(S,w){for(var A=Object.keys(w),C=0;C<A.length;C++){var I=A[C];I==="headOfPipeline"||!w[I].on||w[I].on("log",o.bind(S,I))}},y=function(S,w){var A;if(S.length!==w.length)return!1;for(A=0;A<S.length;A++)if(S[A]!==w[A])return!1;return!0},b=function(S,w,A,C,I,T){var U=A-w,D=C-w,E=I-A;return{start:{dts:S,pts:S+U},end:{dts:S+D,pts:S+E},prependedContentDuration:T,baseMediaDecodeTime:S}};return n=function(S,w){var A=[],C,I=0,T=0,U=1/0;w=w||{},C=w.firstSequenceNumber||0,n.prototype.init.call(this),this.push=function(D){h.collectDtsInfo(S,D),S&&i.forEach(function(E){S[E]=D[E]}),A.push(D)},this.setEarliestDts=function(D){I=D},this.setVideoBaseMediaDecodeTime=function(D){U=D},this.setAudioAppendStart=function(D){T=D},this.flush=function(){var D,E,R,V,H,Y,K;if(A.length===0){this.trigger("done","AudioSegmentStream");return}D=p.trimAdtsFramesByEarliestDts(A,S,I),S.baseMediaDecodeTime=h.calculateTrackBaseMediaDecodeTime(S,w.keepOriginalTimestamps),K=p.prefixWithSilence(S,D,T,U),S.samples=p.generateSampleTable(D),R=t.mdat(p.concatenateFrameData(D)),A=[],E=t.moof(C,[S]),V=new Uint8Array(E.byteLength+R.byteLength),C++,V.set(E),V.set(R,E.byteLength),h.clearDtsInfo(S),H=Math.ceil(l*1024/S.samplerate),D.length&&(Y=D.length*H,this.trigger("segmentTimingInfo",b(_.audioTsToVideoTs(S.baseMediaDecodeTime,S.samplerate),D[0].dts,D[0].pts,D[0].dts+Y,D[0].pts+Y,K||0)),this.trigger("timingInfo",{start:D[0].pts,end:D[0].pts+Y})),this.trigger("data",{track:S,boxes:V}),this.trigger("done","AudioSegmentStream")},this.reset=function(){h.clearDtsInfo(S),A=[],this.trigger("reset")}},n.prototype=new f,u=function(S,w){var A,C=[],I=[],T,U;w=w||{},A=w.firstSequenceNumber||0,u.prototype.init.call(this),delete S.minPTS,this.gopCache_=[],this.push=function(D){h.collectDtsInfo(S,D),D.nalUnitType==="seq_parameter_set_rbsp"&&!T&&(T=D.config,S.sps=[D.data],s.forEach(function(E){S[E]=T[E]},this)),D.nalUnitType==="pic_parameter_set_rbsp"&&!U&&(U=D.data,S.pps=[D.data]),C.push(D)},this.flush=function(){for(var D,E,R,V,H,Y,K=0,B,P;C.length&&C[0].nalUnitType!=="access_unit_delimiter_rbsp";)C.shift();if(C.length===0){this.resetStream_(),this.trigger("done","VideoSegmentStream");return}if(D=r.groupNalsIntoFrames(C),R=r.groupFramesIntoGops(D),R[0][0].keyFrame||(E=this.getGopForFusion_(C[0],S),E?(K=E.duration,R.unshift(E),R.byteLength+=E.byteLength,R.nalCount+=E.nalCount,R.pts=E.pts,R.dts=E.dts,R.duration+=E.duration):R=r.extendFirstKeyFrame(R)),I.length){var M;if(w.alignGopsAtEnd?M=this.alignGopsAtEnd_(R):M=this.alignGopsAtStart_(R),!M){this.gopCache_.unshift({gop:R.pop(),pps:S.pps,sps:S.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),C=[],this.resetStream_(),this.trigger("done","VideoSegmentStream");return}h.clearDtsInfo(S),R=M}h.collectDtsInfo(S,R),S.samples=r.generateSampleTable(R),H=t.mdat(r.concatenateNalData(R)),S.baseMediaDecodeTime=h.calculateTrackBaseMediaDecodeTime(S,w.keepOriginalTimestamps),this.trigger("processedGopsInfo",R.map(function(L){return{pts:L.pts,dts:L.dts,byteLength:L.byteLength}})),B=R[0],P=R[R.length-1],this.trigger("segmentTimingInfo",b(S.baseMediaDecodeTime,B.dts,B.pts,P.dts+P.duration,P.pts+P.duration,K)),this.trigger("timingInfo",{start:R[0].pts,end:R[R.length-1].pts+R[R.length-1].duration}),this.gopCache_.unshift({gop:R.pop(),pps:S.pps,sps:S.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),C=[],this.trigger("baseMediaDecodeTime",S.baseMediaDecodeTime),this.trigger("timelineStartInfo",S.timelineStartInfo),V=t.moof(A,[S]),Y=new Uint8Array(V.byteLength+H.byteLength),A++,Y.set(V),Y.set(H,V.byteLength),this.trigger("data",{track:S,boxes:Y}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),C=[],this.gopCache_.length=0,I.length=0,this.trigger("reset")},this.resetStream_=function(){h.clearDtsInfo(S),T=void 0,U=void 0},this.getGopForFusion_=function(D){var E=45e3,R=1/0,V,H,Y,K,B;for(B=0;B<this.gopCache_.length;B++)K=this.gopCache_[B],Y=K.gop,!(!(S.pps&&y(S.pps[0],K.pps[0]))||!(S.sps&&y(S.sps[0],K.sps[0])))&&(Y.dts<S.timelineStartInfo.dts||(V=D.dts-Y.dts-Y.duration,V>=-1e4&&V<=E&&(!H||R>V)&&(H=K,R=V)));return H?H.gop:null},this.alignGopsAtStart_=function(D){var E,R,V,H,Y,K,B,P;for(Y=D.byteLength,K=D.nalCount,B=D.duration,E=R=0;E<I.length&&R<D.length&&(V=I[E],H=D[R],V.pts!==H.pts);){if(H.pts>V.pts){E++;continue}R++,Y-=H.byteLength,K-=H.nalCount,B-=H.duration}return R===0?D:R===D.length?null:(P=D.slice(R),P.byteLength=Y,P.duration=B,P.nalCount=K,P.pts=P[0].pts,P.dts=P[0].dts,P)},this.alignGopsAtEnd_=function(D){var E,R,V,H,Y,K;for(E=I.length-1,R=D.length-1,Y=null,K=!1;E>=0&&R>=0;){if(V=I[E],H=D[R],V.pts===H.pts){K=!0;break}if(V.pts>H.pts){E--;continue}E===I.length-1&&(Y=R),R--}if(!K&&Y===null)return null;var B;if(K?B=R:B=Y,B===0)return D;var P=D.slice(B),M=P.reduce(function(L,O){return L.byteLength+=O.byteLength,L.duration+=O.duration,L.nalCount+=O.nalCount,L},{byteLength:0,duration:0,nalCount:0});return P.byteLength=M.byteLength,P.duration=M.duration,P.nalCount=M.nalCount,P.pts=P[0].pts,P.dts=P[0].dts,P},this.alignGopsWith=function(D){I=D}},u.prototype=new f,e=function(S,w){this.numberOfTracks=0,this.metadataStream=w,S=S||{},typeof S.remux<"u"?this.remuxTracks=!!S.remux:this.remuxTracks=!0,typeof S.keepOriginalTimestamps=="boolean"?this.keepOriginalTimestamps=S.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,e.prototype.init.call(this),this.push=function(A){if(A.text)return this.pendingCaptions.push(A);if(A.frames)return this.pendingMetadata.push(A);this.pendingTracks.push(A.track),this.pendingBytes+=A.boxes.byteLength,A.track.type==="video"&&(this.videoTrack=A.track,this.pendingBoxes.push(A.boxes)),A.track.type==="audio"&&(this.audioTrack=A.track,this.pendingBoxes.unshift(A.boxes))}},e.prototype=new f,e.prototype.flush=function(F){var S=0,w={captions:[],captionStreams:{},metadata:[],info:{}},A,C,I,T=0,U;if(this.pendingTracks.length<this.numberOfTracks){if(F!=="VideoSegmentStream"&&F!=="AudioSegmentStream")return;if(this.remuxTracks)return;if(this.pendingTracks.length===0){this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}if(this.videoTrack?(T=this.videoTrack.timelineStartInfo.pts,s.forEach(function(D){w.info[D]=this.videoTrack[D]},this)):this.audioTrack&&(T=this.audioTrack.timelineStartInfo.pts,i.forEach(function(D){w.info[D]=this.audioTrack[D]},this)),this.videoTrack||this.audioTrack){for(this.pendingTracks.length===1?w.type=this.pendingTracks[0].type:w.type="combined",this.emittedTracks+=this.pendingTracks.length,I=t.initSegment(this.pendingTracks),w.initSegment=new Uint8Array(I.byteLength),w.initSegment.set(I),w.data=new Uint8Array(this.pendingBytes),U=0;U<this.pendingBoxes.length;U++)w.data.set(this.pendingBoxes[U],S),S+=this.pendingBoxes[U].byteLength;for(U=0;U<this.pendingCaptions.length;U++)A=this.pendingCaptions[U],A.startTime=_.metadataTsToSeconds(A.startPts,T,this.keepOriginalTimestamps),A.endTime=_.metadataTsToSeconds(A.endPts,T,this.keepOriginalTimestamps),w.captionStreams[A.stream]=!0,w.captions.push(A);for(U=0;U<this.pendingMetadata.length;U++)C=this.pendingMetadata[U],C.cueTime=_.metadataTsToSeconds(C.pts,T,this.keepOriginalTimestamps),w.metadata.push(C);for(w.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",w),U=0;U<w.captions.length;U++)A=w.captions[U],this.trigger("caption",A);for(U=0;U<w.metadata.length;U++)C=w.metadata[U],this.trigger("id3Frame",C)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},e.prototype.setRemux=function(F){this.remuxTracks=F},d=function(S){var w=this,A=!0,C,I;d.prototype.init.call(this),S=S||{},this.baseMediaDecodeTime=S.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var T={};this.transmuxPipeline_=T,T.type="aac",T.metadataStream=new m.MetadataStream,T.aacStream=new c,T.audioTimestampRolloverStream=new m.TimestampRolloverStream("audio"),T.timedMetadataTimestampRolloverStream=new m.TimestampRolloverStream("timed-metadata"),T.adtsStream=new v,T.coalesceStream=new e(S,T.metadataStream),T.headOfPipeline=T.aacStream,T.aacStream.pipe(T.audioTimestampRolloverStream).pipe(T.adtsStream),T.aacStream.pipe(T.timedMetadataTimestampRolloverStream).pipe(T.metadataStream).pipe(T.coalesceStream),T.metadataStream.on("timestamp",function(U){T.aacStream.setTimestamp(U.timeStamp)}),T.aacStream.on("data",function(U){U.type!=="timed-metadata"&&U.type!=="audio"||T.audioSegmentStream||(I=I||{timelineStartInfo:{baseMediaDecodeTime:w.baseMediaDecodeTime},codec:"adts",type:"audio"},T.coalesceStream.numberOfTracks++,T.audioSegmentStream=new n(I,S),T.audioSegmentStream.on("log",w.getLogTrigger_("audioSegmentStream")),T.audioSegmentStream.on("timingInfo",w.trigger.bind(w,"audioTimingInfo")),T.adtsStream.pipe(T.audioSegmentStream).pipe(T.coalesceStream),w.trigger("trackinfo",{hasAudio:!!I,hasVideo:!!C}))}),T.coalesceStream.on("data",this.trigger.bind(this,"data")),T.coalesceStream.on("done",this.trigger.bind(this,"done")),x(this,T)},this.setupTsPipeline=function(){var T={};this.transmuxPipeline_=T,T.type="ts",T.metadataStream=new m.MetadataStream,T.packetStream=new m.TransportPacketStream,T.parseStream=new m.TransportParseStream,T.elementaryStream=new m.ElementaryStream,T.timestampRolloverStream=new m.TimestampRolloverStream,T.adtsStream=new v,T.h264Stream=new g,T.captionStream=new m.CaptionStream(S),T.coalesceStream=new e(S,T.metadataStream),T.headOfPipeline=T.packetStream,T.packetStream.pipe(T.parseStream).pipe(T.elementaryStream).pipe(T.timestampRolloverStream),T.timestampRolloverStream.pipe(T.h264Stream),T.timestampRolloverStream.pipe(T.adtsStream),T.timestampRolloverStream.pipe(T.metadataStream).pipe(T.coalesceStream),T.h264Stream.pipe(T.captionStream).pipe(T.coalesceStream),T.elementaryStream.on("data",function(U){var D;if(U.type==="metadata"){for(D=U.tracks.length;D--;)!C&&U.tracks[D].type==="video"?(C=U.tracks[D],C.timelineStartInfo.baseMediaDecodeTime=w.baseMediaDecodeTime):!I&&U.tracks[D].type==="audio"&&(I=U.tracks[D],I.timelineStartInfo.baseMediaDecodeTime=w.baseMediaDecodeTime);C&&!T.videoSegmentStream&&(T.coalesceStream.numberOfTracks++,T.videoSegmentStream=new u(C,S),T.videoSegmentStream.on("log",w.getLogTrigger_("videoSegmentStream")),T.videoSegmentStream.on("timelineStartInfo",function(E){I&&!S.keepOriginalTimestamps&&(I.timelineStartInfo=E,T.audioSegmentStream.setEarliestDts(E.dts-w.baseMediaDecodeTime))}),T.videoSegmentStream.on("processedGopsInfo",w.trigger.bind(w,"gopInfo")),T.videoSegmentStream.on("segmentTimingInfo",w.trigger.bind(w,"videoSegmentTimingInfo")),T.videoSegmentStream.on("baseMediaDecodeTime",function(E){I&&T.audioSegmentStream.setVideoBaseMediaDecodeTime(E)}),T.videoSegmentStream.on("timingInfo",w.trigger.bind(w,"videoTimingInfo")),T.h264Stream.pipe(T.videoSegmentStream).pipe(T.coalesceStream)),I&&!T.audioSegmentStream&&(T.coalesceStream.numberOfTracks++,T.audioSegmentStream=new n(I,S),T.audioSegmentStream.on("log",w.getLogTrigger_("audioSegmentStream")),T.audioSegmentStream.on("timingInfo",w.trigger.bind(w,"audioTimingInfo")),T.audioSegmentStream.on("segmentTimingInfo",w.trigger.bind(w,"audioSegmentTimingInfo")),T.adtsStream.pipe(T.audioSegmentStream).pipe(T.coalesceStream)),w.trigger("trackinfo",{hasAudio:!!I,hasVideo:!!C})}}),T.coalesceStream.on("data",this.trigger.bind(this,"data")),T.coalesceStream.on("id3Frame",function(U){U.dispatchType=T.metadataStream.dispatchType,w.trigger("id3Frame",U)}),T.coalesceStream.on("caption",this.trigger.bind(this,"caption")),T.coalesceStream.on("done",this.trigger.bind(this,"done")),x(this,T)},this.setBaseMediaDecodeTime=function(T){var U=this.transmuxPipeline_;S.keepOriginalTimestamps||(this.baseMediaDecodeTime=T),I&&(I.timelineStartInfo.dts=void 0,I.timelineStartInfo.pts=void 0,h.clearDtsInfo(I),U.audioTimestampRolloverStream&&U.audioTimestampRolloverStream.discontinuity()),C&&(U.videoSegmentStream&&(U.videoSegmentStream.gopCache_=[]),C.timelineStartInfo.dts=void 0,C.timelineStartInfo.pts=void 0,h.clearDtsInfo(C),U.captionStream.reset()),U.timestampRolloverStream&&U.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(T){I&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(T)},this.setRemux=function(T){var U=this.transmuxPipeline_;S.remux=T,U&&U.coalesceStream&&U.coalesceStream.setRemux(T)},this.alignGopsWith=function(T){C&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(T)},this.getLogTrigger_=function(T){var U=this;return function(D){D.stream=T,U.trigger("log",D)}},this.push=function(T){if(A){var U=a(T);U&&this.transmuxPipeline_.type!=="aac"?this.setupAacPipeline():!U&&this.transmuxPipeline_.type!=="ts"&&this.setupTsPipeline(),A=!1}this.transmuxPipeline_.headOfPipeline.push(T)},this.flush=function(){A=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},d.prototype=new f,ft={Transmuxer:d,VideoSegmentStream:u,AudioSegmentStream:n,AUDIO_PROPERTIES:i,VIDEO_PROPERTIES:s,generateSegmentTimingInfo:b},ft}var ct,Gi;function an(){if(Gi)return ct;Gi=1;var f=Ur().discardEmulationPreventionBytes,t=Ir().CaptionStream,r=zt(),p=Ht(),h=Wt(),m=Gt(),_=Fr(),v=function(u,n){for(var d=u,e=0;e<n.length;e++){var o=n[e];if(d<o.size)return o;d-=o.size}return null},g=function(u,n,d){var e=new DataView(u.buffer,u.byteOffset,u.byteLength),o={logs:[],seiNals:[]},x,y,b,F;for(y=0;y+4<u.length;y+=b)if(b=e.getUint32(y),y+=4,!(b<=0))switch(u[y]&31){case 6:var S=u.subarray(y+1,y+1+b),w=v(y,n);if(x={nalUnitType:"sei_rbsp",size:b,data:S,escapedRBSP:f(S),trackId:d},w)x.pts=w.pts,x.dts=w.dts,F=w;else if(F)x.pts=F.pts,x.dts=F.dts;else{o.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+y+" for trackId "+d+". See mux.js#223."});break}o.seiNals.push(x);break}return o},c=function(u,n,d){var e=n,o=d.defaultSampleDuration||0,x=d.defaultSampleSize||0,y=d.trackId,b=[];return u.forEach(function(F){var S=h(F),w=S.samples;w.forEach(function(A){A.duration===void 0&&(A.duration=o),A.size===void 0&&(A.size=x),A.trackId=y,A.dts=e,A.compositionTimeOffset===void 0&&(A.compositionTimeOffset=0),typeof e=="bigint"?(A.pts=e+_.BigInt(A.compositionTimeOffset),e+=_.BigInt(A.duration)):(A.pts=e+A.compositionTimeOffset,e+=A.duration)}),b=b.concat(w)}),b},a=function(u,n){var d=r(u,["moof","traf"]),e=r(u,["mdat"]),o={},x=[];return e.forEach(function(y,b){var F=d[b];x.push({mdat:y,traf:F})}),x.forEach(function(y){var b=y.mdat,F=y.traf,S=r(F,["tfhd"]),w=m(S[0]),A=w.trackId,C=r(F,["tfdt"]),I=C.length>0?p(C[0]).baseMediaDecodeTime:0,T=r(F,["trun"]),U,D;n===A&&T.length>0&&(U=c(T,I,w),D=g(b,U,A),o[A]||(o[A]={seiNals:[],logs:[]}),o[A].seiNals=o[A].seiNals.concat(D.seiNals),o[A].logs=o[A].logs.concat(D.logs))}),o},l=function(u,n,d){var e;if(n===null)return null;e=a(u,n);var o=e[n]||{};return{seiNals:o.seiNals,logs:o.logs,timescale:d}},i=function(){var u=!1,n,d,e,o,x,y;this.isInitialized=function(){return u},this.init=function(b){n=new t,u=!0,y=b?b.isPartial:!1,n.on("data",function(F){F.startTime=F.startPts/o,F.endTime=F.endPts/o,x.captions.push(F),x.captionStreams[F.stream]=!0}),n.on("log",function(F){x.logs.push(F)})},this.isNewInit=function(b,F){return b&&b.length===0||F&&typeof F=="object"&&Object.keys(F).length===0?!1:e!==b[0]||o!==F[e]},this.parse=function(b,F,S){var w;if(this.isInitialized()){if(!F||!S)return null;if(this.isNewInit(F,S))e=F[0],o=S[e];else if(e===null||!o)return d.push(b),null}else return null;for(;d.length>0;){var A=d.shift();this.parse(A,F,S)}return w=l(b,e,o),w&&w.logs&&(x.logs=x.logs.concat(w.logs)),w===null||!w.seiNals?x.logs.length?{logs:x.logs,captions:[],captionStreams:[]}:null:(this.pushNals(w.seiNals),this.flushStream(),x)},this.pushNals=function(b){if(!this.isInitialized()||!b||b.length===0)return null;b.forEach(function(F){n.push(F)})},this.flushStream=function(){if(!this.isInitialized())return null;y?n.partialFlush():n.flush()},this.clearParsedCaptions=function(){x.captions=[],x.captionStreams={},x.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;n.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){d=[],e=null,o=null,x?this.clearParsedCaptions():x={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()};return ct=i,ct}var pt,Wi;function sn(){return Wi||(Wi=1,pt={generator:Se(),probe:tn(),Transmuxer:ht().Transmuxer,AudioSegmentStream:ht().AudioSegmentStream,VideoSegmentStream:ht().VideoSegmentStream,CaptionParser:an()}),pt}var mt,Hi;function $t(){if(Hi)return mt;Hi=1;var f;return f=function(r,p){var h=0,m=16384,_=function(i,s){var u,n=i.position+s;n<i.bytes.byteLength||(u=new Uint8Array(n*2),u.set(i.bytes.subarray(0,i.position),0),i.bytes=u,i.view=new DataView(i.bytes.buffer))},v=f.widthBytes||new Uint8Array(5),g=f.heightBytes||new Uint8Array(6),c=f.videocodecidBytes||new Uint8Array(12),a;if(!f.widthBytes){for(a=0;a<5;a++)v[a]="width".charCodeAt(a);for(a=0;a<6;a++)g[a]="height".charCodeAt(a);for(a=0;a<12;a++)c[a]="videocodecid".charCodeAt(a);f.widthBytes=v,f.heightBytes=g,f.videocodecidBytes=c}switch(this.keyFrame=!1,r){case f.VIDEO_TAG:this.length=16,m*=6;break;case f.AUDIO_TAG:this.length=13,this.keyFrame=!0;break;case f.METADATA_TAG:this.length=29,this.keyFrame=!0;break;default:throw new Error("Unknown FLV tag type")}this.bytes=new Uint8Array(m),this.view=new DataView(this.bytes.buffer),this.bytes[0]=r,this.position=this.length,this.keyFrame=p,this.pts=0,this.dts=0,this.writeBytes=function(l,i,s){var u=i||0,n;s=s||l.byteLength,n=u+s,_(this,s),this.bytes.set(l.subarray(u,n),this.position),this.position+=s,this.length=Math.max(this.length,this.position)},this.writeByte=function(l){_(this,1),this.bytes[this.position]=l,this.position++,this.length=Math.max(this.length,this.position)},this.writeShort=function(l){_(this,2),this.view.setUint16(this.position,l),this.position+=2,this.length=Math.max(this.length,this.position)},this.negIndex=function(l){return this.bytes[this.length-l]},this.nalUnitSize=function(){return h===0?0:this.length-(h+4)},this.startNalUnit=function(){if(h>0)throw new Error("Attempted to create new NAL wihout closing the old one");h=this.length,this.length+=4,this.position=this.length},this.endNalUnit=function(l){var i,s;this.length===h+4?this.length-=4:h>0&&(i=h+4,s=this.length-i,this.position=h,this.view.setUint32(this.position,s),this.position=this.length,l&&l.push(this.bytes.subarray(i,i+s))),h=0},this.writeMetaDataDouble=function(l,i){var s;if(_(this,2+l.length+9),this.view.setUint16(this.position,l.length),this.position+=2,l==="width")this.bytes.set(v,this.position),this.position+=5;else if(l==="height")this.bytes.set(g,this.position),this.position+=6;else if(l==="videocodecid")this.bytes.set(c,this.position),this.position+=12;else for(s=0;s<l.length;s++)this.bytes[this.position]=l.charCodeAt(s),this.position++;this.position++,this.view.setFloat64(this.position,i),this.position+=8,this.length=Math.max(this.length,this.position),++h},this.writeMetaDataBoolean=function(l,i){var s;for(_(this,2),this.view.setUint16(this.position,l.length),this.position+=2,s=0;s<l.length;s++)_(this,1),this.bytes[this.position]=l.charCodeAt(s),this.position++;_(this,2),this.view.setUint8(this.position,1),this.position++,this.view.setUint8(this.position,i?1:0),this.position++,this.length=Math.max(this.length,this.position),++h},this.finalize=function(){var l,i;switch(this.bytes[0]){case f.VIDEO_TAG:this.bytes[11]=(this.keyFrame||p?16:32)|7,this.bytes[12]=p?0:1,l=this.pts-this.dts,this.bytes[13]=(l&16711680)>>>16,this.bytes[14]=(l&65280)>>>8,this.bytes[15]=(l&255)>>>0;break;case f.AUDIO_TAG:this.bytes[11]=175,this.bytes[12]=p?0:1;break;case f.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,h),this.position=this.length,this.bytes.set([0,0,9],this.position),this.position+=3,this.length=this.position;break}return i=this.length-11,this.bytes[1]=(i&16711680)>>>16,this.bytes[2]=(i&65280)>>>8,this.bytes[3]=(i&255)>>>0,this.bytes[4]=(this.dts&16711680)>>>16,this.bytes[5]=(this.dts&65280)>>>8,this.bytes[6]=(this.dts&255)>>>0,this.bytes[7]=(this.dts&4278190080)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,_(this,4),this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=f.frameTime(this.bytes),this}},f.AUDIO_TAG=8,f.VIDEO_TAG=9,f.METADATA_TAG=18,f.isAudioFrame=function(t){return f.AUDIO_TAG===t[0]},f.isVideoFrame=function(t){return f.VIDEO_TAG===t[0]},f.isMetaData=function(t){return f.METADATA_TAG===t[0]},f.isKeyFrame=function(t){return f.isVideoFrame(t)?t[11]===23:!!(f.isAudioFrame(t)||f.isMetaData(t))},f.frameTime=function(t){var r=t[4]<<16;return r|=t[5]<<8,r|=t[6]<<0,r|=t[7]<<24,r},mt=f,mt}var gt,$i;function on(){if($i)return gt;$i=1;var f=ee(),t=function r(p){this.numberOfTracks=0,this.metadataStream=p.metadataStream,this.videoTags=[],this.audioTags=[],this.videoTrack=null,this.audioTrack=null,this.pendingCaptions=[],this.pendingMetadata=[],this.pendingTracks=0,this.processedTracks=0,r.prototype.init.call(this),this.push=function(h){if(h.text)return this.pendingCaptions.push(h);if(h.frames)return this.pendingMetadata.push(h);h.track.type==="video"&&(this.videoTrack=h.track,this.videoTags=h.tags,this.pendingTracks++),h.track.type==="audio"&&(this.audioTrack=h.track,this.audioTags=h.tags,this.pendingTracks++)}};return t.prototype=new f,t.prototype.flush=function(r){var p,h,m,_,v={tags:{},captions:[],captionStreams:{},metadata:[]};if(this.pendingTracks<this.numberOfTracks){if(r!=="VideoSegmentStream"&&r!=="AudioSegmentStream")return;if(this.pendingTracks===0&&(this.processedTracks++,this.processedTracks<this.numberOfTracks))return}if(this.processedTracks+=this.pendingTracks,this.pendingTracks=0,!(this.processedTracks<this.numberOfTracks)){for(this.videoTrack?_=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(_=this.audioTrack.timelineStartInfo.pts),v.tags.videoTags=this.videoTags,v.tags.audioTags=this.audioTags,m=0;m<this.pendingCaptions.length;m++)h=this.pendingCaptions[m],h.startTime=h.startPts-_,h.startTime/=9e4,h.endTime=h.endPts-_,h.endTime/=9e4,v.captionStreams[h.stream]=!0,v.captions.push(h);for(m=0;m<this.pendingMetadata.length;m++)p=this.pendingMetadata[m],p.cueTime=p.pts-_,p.cueTime/=9e4,v.metadata.push(p);v.metadata.dispatchType=this.metadataStream.dispatchType,this.videoTrack=null,this.audioTrack=null,this.videoTags=[],this.audioTags=[],this.pendingCaptions.length=0,this.pendingMetadata.length=0,this.pendingTracks=0,this.processedTracks=0,this.trigger("data",v),this.trigger("done")}},gt=t,gt}var xt,Yi;function un(){if(Yi)return xt;Yi=1;var f=function(){var r=this;this.list=[],this.push=function(p){this.list.push({bytes:p.bytes,dts:p.dts,pts:p.pts,keyFrame:p.keyFrame,metaDataTag:p.metaDataTag})},Object.defineProperty(this,"length",{get:function(){return r.list.length}})};return xt=f,xt}var vt,Xi;function ln(){if(Xi)return vt;Xi=1;var f=ee(),t=$t(),r=we(),p=ye(),h=qt().H264Stream,m=on(),_=un(),v,g,c,a,l,i;return a=function(u,n){typeof n.pts=="number"&&(u.timelineStartInfo.pts===void 0?u.timelineStartInfo.pts=n.pts:u.timelineStartInfo.pts=Math.min(u.timelineStartInfo.pts,n.pts)),typeof n.dts=="number"&&(u.timelineStartInfo.dts===void 0?u.timelineStartInfo.dts=n.dts:u.timelineStartInfo.dts=Math.min(u.timelineStartInfo.dts,n.dts))},l=function(u,n){var d=new t(t.METADATA_TAG);return d.dts=n,d.pts=n,d.writeMetaDataDouble("videocodecid",7),d.writeMetaDataDouble("width",u.width),d.writeMetaDataDouble("height",u.height),d},i=function(u,n){var d,e=new t(t.VIDEO_TAG,!0);for(e.dts=n,e.pts=n,e.writeByte(1),e.writeByte(u.profileIdc),e.writeByte(u.profileCompatibility),e.writeByte(u.levelIdc),e.writeByte(255),e.writeByte(225),e.writeShort(u.sps[0].length),e.writeBytes(u.sps[0]),e.writeByte(u.pps.length),d=0;d<u.pps.length;++d)e.writeShort(u.pps[d].length),e.writeBytes(u.pps[d]);return e},c=function(u){var n=[],d=[],e;c.prototype.init.call(this),this.push=function(o){a(u,o),u&&(u.audioobjecttype=o.audioobjecttype,u.channelcount=o.channelcount,u.samplerate=o.samplerate,u.samplingfrequencyindex=o.samplingfrequencyindex,u.samplesize=o.samplesize,u.extraData=u.audioobjecttype<<11|u.samplingfrequencyindex<<7|u.channelcount<<3),o.pts=Math.round(o.pts/90),o.dts=Math.round(o.dts/90),n.push(o)},this.flush=function(){var o,x,y,b=new _;if(n.length===0){this.trigger("done","AudioSegmentStream");return}for(y=-1/0;n.length;)o=n.shift(),d.length&&o.pts>=d[0]&&(y=d.shift(),this.writeMetaDataTags(b,y)),(u.extraData!==e||o.pts-y>=1e3)&&(this.writeMetaDataTags(b,o.pts),e=u.extraData,y=o.pts),x=new t(t.AUDIO_TAG),x.pts=o.pts,x.dts=o.dts,x.writeBytes(o.data),b.push(x.finalize());d.length=0,e=null,this.trigger("data",{track:u,tags:b.list}),this.trigger("done","AudioSegmentStream")},this.writeMetaDataTags=function(o,x){var y;y=new t(t.METADATA_TAG),y.pts=x,y.dts=x,y.writeMetaDataDouble("audiocodecid",10),y.writeMetaDataBoolean("stereo",u.channelcount===2),y.writeMetaDataDouble("audiosamplerate",u.samplerate),y.writeMetaDataDouble("audiosamplesize",16),o.push(y.finalize()),y=new t(t.AUDIO_TAG,!0),y.pts=x,y.dts=x,y.view.setUint16(y.position,u.extraData),y.position+=2,y.length=Math.max(y.length,y.position),o.push(y.finalize())},this.onVideoKeyFrame=function(o){d.push(o)}},c.prototype=new f,g=function(u){var n=[],d,e;g.prototype.init.call(this),this.finishFrame=function(o,x){if(x){if(d&&u&&u.newMetadata&&(x.keyFrame||o.length===0)){var y=l(d,x.dts).finalize(),b=i(u,x.dts).finalize();y.metaDataTag=b.metaDataTag=!0,o.push(y),o.push(b),u.newMetadata=!1,this.trigger("keyframe",x.dts)}x.endNalUnit(),o.push(x.finalize()),e=null}},this.push=function(o){a(u,o),o.pts=Math.round(o.pts/90),o.dts=Math.round(o.dts/90),n.push(o)},this.flush=function(){for(var o,x=new _;n.length&&n[0].nalUnitType!=="access_unit_delimiter_rbsp";)n.shift();if(n.length===0){this.trigger("done","VideoSegmentStream");return}for(;n.length;)o=n.shift(),o.nalUnitType==="seq_parameter_set_rbsp"?(u.newMetadata=!0,d=o.config,u.width=d.width,u.height=d.height,u.sps=[o.data],u.profileIdc=d.profileIdc,u.levelIdc=d.levelIdc,u.profileCompatibility=d.profileCompatibility,e.endNalUnit()):o.nalUnitType==="pic_parameter_set_rbsp"?(u.newMetadata=!0,u.pps=[o.data],e.endNalUnit()):o.nalUnitType==="access_unit_delimiter_rbsp"?(e&&this.finishFrame(x,e),e=new t(t.VIDEO_TAG),e.pts=o.pts,e.dts=o.dts):(o.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(e.keyFrame=!0),e.endNalUnit()),e.startNalUnit(),e.writeBytes(o.data);e&&this.finishFrame(x,e),this.trigger("data",{track:u,tags:x.list}),this.trigger("done","VideoSegmentStream")}},g.prototype=new f,v=function(u){var n=this,d,e,o,x,y,b,F,S,w,A,C,I;v.prototype.init.call(this),u=u||{},this.metadataStream=new r.MetadataStream,u.metadataStream=this.metadataStream,d=new r.TransportPacketStream,e=new r.TransportParseStream,o=new r.ElementaryStream,x=new r.TimestampRolloverStream("video"),y=new r.TimestampRolloverStream("audio"),b=new r.TimestampRolloverStream("timed-metadata"),F=new p,S=new h,I=new m(u),d.pipe(e).pipe(o),o.pipe(x).pipe(S),o.pipe(y).pipe(F),o.pipe(b).pipe(this.metadataStream).pipe(I),C=new r.CaptionStream(u),S.pipe(C).pipe(I),o.on("data",function(T){var U,D,E;if(T.type==="metadata"){for(U=T.tracks.length;U--;)T.tracks[U].type==="video"?D=T.tracks[U]:T.tracks[U].type==="audio"&&(E=T.tracks[U]);D&&!w&&(I.numberOfTracks++,w=new g(D),S.pipe(w).pipe(I)),E&&!A&&(I.numberOfTracks++,A=new c(E),F.pipe(A).pipe(I),w&&w.on("keyframe",A.onVideoKeyFrame))}}),this.push=function(T){d.push(T)},this.flush=function(){d.flush()},this.resetCaptions=function(){C.reset()},I.on("data",function(T){n.trigger("data",T)}),I.on("done",function(){n.trigger("done")})},v.prototype=new f,vt=v,vt}var _t,Ki;function dn(){if(Ki)return _t;Ki=1;var f=$t(),t=function(p,h,m){var _=new Uint8Array(9),v=new DataView(_.buffer),g,c,a;return p=p||0,h=h===void 0?!0:h,m=m===void 0?!0:m,v.setUint8(0,70),v.setUint8(1,76),v.setUint8(2,86),v.setUint8(3,1),v.setUint8(4,(h?4:0)|(m?1:0)),v.setUint32(5,_.byteLength),p<=0?(c=new Uint8Array(_.byteLength+4),c.set(_),c.set([0,0,0,0],_.byteLength),c):(g=new f(f.METADATA_TAG),g.pts=g.dts=0,g.writeMetaDataDouble("duration",p),a=g.finalize().length,c=new Uint8Array(_.byteLength+a),c.set(_),c.set(v.byteLength,a),c)};return _t=t,_t}var yt,ji;function fn(){return ji||(ji=1,yt={tag:$t(),Transmuxer:ln(),getFlvHeader:dn()}),yt}var St,Qi;function hn(){return Qi||(Qi=1,St=we()),St}var bt,Zi;function cn(){if(Zi)return bt;Zi=1;var f=ee(),t=Se(),r=Dr(),p=be(),h=ie().ONE_SECOND_IN_TS,m=Rr(),_=function v(g,c){var a=[],l=0,i=0,s=0,u=1/0,n=null,d=null;c=c||{},v.prototype.init.call(this),this.push=function(e){p.collectDtsInfo(g,e),g&&m.forEach(function(o){g[o]=e[o]}),a.push(e)},this.setEarliestDts=function(e){i=e},this.setVideoBaseMediaDecodeTime=function(e){u=e},this.setAudioAppendStart=function(e){s=e},this.processFrames_=function(){var e,o,x,y,b;a.length!==0&&(e=r.trimAdtsFramesByEarliestDts(a,g,i),e.length!==0&&(g.baseMediaDecodeTime=p.calculateTrackBaseMediaDecodeTime(g,c.keepOriginalTimestamps),r.prefixWithSilence(g,e,s,u),g.samples=r.generateSampleTable(e),x=t.mdat(r.concatenateFrameData(e)),a=[],o=t.moof(l,[g]),l++,g.initSegment=t.initSegment([g]),y=new Uint8Array(o.byteLength+x.byteLength),y.set(o),y.set(x,o.byteLength),p.clearDtsInfo(g),n===null&&(d=n=e[0].pts),d+=e.length*(h*1024/g.samplerate),b={start:n},this.trigger("timingInfo",b),this.trigger("data",{track:g,boxes:y})))},this.flush=function(){this.processFrames_(),this.trigger("timingInfo",{start:n,end:d}),this.resetTiming_(),this.trigger("done","AudioSegmentStream")},this.partialFlush=function(){this.processFrames_(),this.trigger("partialdone","AudioSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","AudioSegmentStream")},this.resetTiming_=function(){p.clearDtsInfo(g),n=null,d=null},this.reset=function(){this.resetTiming_(),a=[],this.trigger("reset")}};return _.prototype=new f,bt=_,bt}var Tt,Ji;function pn(){if(Ji)return Tt;Ji=1;var f=ee(),t=Se(),r=be(),p=Pr(),h=Lr(),m=function _(v,g){var c=0,a=[],l=[],i,s,u=null,n=null,d,e=!0;g=g||{},_.prototype.init.call(this),this.push=function(o){r.collectDtsInfo(v,o),typeof v.timelineStartInfo.dts>"u"&&(v.timelineStartInfo.dts=o.dts),o.nalUnitType==="seq_parameter_set_rbsp"&&!i&&(i=o.config,v.sps=[o.data],h.forEach(function(x){v[x]=i[x]},this)),o.nalUnitType==="pic_parameter_set_rbsp"&&!s&&(s=o.data,v.pps=[o.data]),a.push(o)},this.processNals_=function(o){var x;for(a=l.concat(a);a.length&&a[0].nalUnitType!=="access_unit_delimiter_rbsp";)a.shift();if(a.length!==0){var y=p.groupNalsIntoFrames(a);if(y.length){if(l=y[y.length-1],o&&(y.pop(),y.duration-=l.duration,y.nalCount-=l.length,y.byteLength-=l.byteLength),!y.length){a=[];return}if(this.trigger("timelineStartInfo",v.timelineStartInfo),e){if(d=p.groupFramesIntoGops(y),!d[0][0].keyFrame){if(d=p.extendFirstKeyFrame(d),!d[0][0].keyFrame){a=[].concat.apply([],y).concat(l),l=[];return}y=[].concat.apply([],d),y.duration=d.duration}e=!1}for(u===null&&(u=y[0].pts,n=u),n+=y.duration,this.trigger("timingInfo",{start:u,end:n}),x=0;x<y.length;x++){var b=y[x];v.samples=p.generateSampleTableForFrame(b);var F=t.mdat(p.concatenateNalDataForFrame(b));r.clearDtsInfo(v),r.collectDtsInfo(v,b),v.baseMediaDecodeTime=r.calculateTrackBaseMediaDecodeTime(v,g.keepOriginalTimestamps);var S=t.moof(c,[v]);c++,v.initSegment=t.initSegment([v]);var w=new Uint8Array(S.byteLength+F.byteLength);w.set(S),w.set(F,S.byteLength),this.trigger("data",{track:v,boxes:w,sequence:c,videoFrameDts:b.dts,videoFramePts:b.pts})}a=[]}}},this.resetTimingAndConfig_=function(){i=void 0,s=void 0,u=null,n=null},this.partialFlush=function(){this.processNals_(!0),this.trigger("partialdone","VideoSegmentStream")},this.flush=function(){this.processNals_(!1),this.resetTimingAndConfig_(),this.trigger("done","VideoSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","VideoSegmentStream")},this.reset=function(){this.resetTimingAndConfig_(),l=[],a=[],e=!0,this.trigger("reset")}};return m.prototype=new f,Tt=m,Tt}var wt,er;function mn(){if(er)return wt;er=1;var f=ee(),t=we(),r=wr(),p=cn(),h=pn(),m=be(),_=Fe().isLikelyAacData,v=ye(),g=Er(),c=ie(),a=function(d){return d.prototype=new f,d.prototype.init.call(d),d},l=function(d){var e={type:"ts",tracks:{audio:null,video:null},packet:new t.TransportPacketStream,parse:new t.TransportParseStream,elementary:new t.ElementaryStream,timestampRollover:new t.TimestampRolloverStream,adts:new r.Adts,h264:new r.h264.H264Stream,captionStream:new t.CaptionStream(d),metadataStream:new t.MetadataStream};return e.headOfPipeline=e.packet,e.packet.pipe(e.parse).pipe(e.elementary).pipe(e.timestampRollover),e.timestampRollover.pipe(e.h264),e.h264.pipe(e.captionStream),e.timestampRollover.pipe(e.metadataStream),e.timestampRollover.pipe(e.adts),e.elementary.on("data",function(o){if(o.type==="metadata"){for(var x=0;x<o.tracks.length;x++)e.tracks[o.tracks[x].type]||(e.tracks[o.tracks[x].type]=o.tracks[x],e.tracks[o.tracks[x].type].timelineStartInfo.baseMediaDecodeTime=d.baseMediaDecodeTime);e.tracks.video&&!e.videoSegmentStream&&(e.videoSegmentStream=new h(e.tracks.video,d),e.videoSegmentStream.on("timelineStartInfo",function(y){e.tracks.audio&&!d.keepOriginalTimestamps&&e.audioSegmentStream.setEarliestDts(y.dts-d.baseMediaDecodeTime)}),e.videoSegmentStream.on("timingInfo",e.trigger.bind(e,"videoTimingInfo")),e.videoSegmentStream.on("data",function(y){e.trigger("data",{type:"video",data:y})}),e.videoSegmentStream.on("done",e.trigger.bind(e,"done")),e.videoSegmentStream.on("partialdone",e.trigger.bind(e,"partialdone")),e.videoSegmentStream.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),e.h264.pipe(e.videoSegmentStream)),e.tracks.audio&&!e.audioSegmentStream&&(e.audioSegmentStream=new p(e.tracks.audio,d),e.audioSegmentStream.on("data",function(y){e.trigger("data",{type:"audio",data:y})}),e.audioSegmentStream.on("done",e.trigger.bind(e,"done")),e.audioSegmentStream.on("partialdone",e.trigger.bind(e,"partialdone")),e.audioSegmentStream.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),e.audioSegmentStream.on("timingInfo",e.trigger.bind(e,"audioTimingInfo")),e.adts.pipe(e.audioSegmentStream)),e.trigger("trackinfo",{hasAudio:!!e.tracks.audio,hasVideo:!!e.tracks.video})}}),e.captionStream.on("data",function(o){var x;e.tracks.video?x=e.tracks.video.timelineStartInfo.pts||0:x=0,o.startTime=c.metadataTsToSeconds(o.startPts,x,d.keepOriginalTimestamps),o.endTime=c.metadataTsToSeconds(o.endPts,x,d.keepOriginalTimestamps),e.trigger("caption",o)}),e=a(e),e.metadataStream.on("data",e.trigger.bind(e,"id3Frame")),e},i=function(d){var e={type:"aac",tracks:{audio:null},metadataStream:new t.MetadataStream,aacStream:new g,audioRollover:new t.TimestampRolloverStream("audio"),timedMetadataRollover:new t.TimestampRolloverStream("timed-metadata"),adtsStream:new v(!0)};return e.headOfPipeline=e.aacStream,e.aacStream.pipe(e.audioRollover).pipe(e.adtsStream),e.aacStream.pipe(e.timedMetadataRollover).pipe(e.metadataStream),e.metadataStream.on("timestamp",function(o){e.aacStream.setTimestamp(o.timeStamp)}),e.aacStream.on("data",function(o){o.type!=="timed-metadata"&&o.type!=="audio"||e.audioSegmentStream||(e.tracks.audio=e.tracks.audio||{timelineStartInfo:{baseMediaDecodeTime:d.baseMediaDecodeTime},codec:"adts",type:"audio"},e.audioSegmentStream=new p(e.tracks.audio,d),e.audioSegmentStream.on("data",function(x){e.trigger("data",{type:"audio",data:x})}),e.audioSegmentStream.on("partialdone",e.trigger.bind(e,"partialdone")),e.audioSegmentStream.on("done",e.trigger.bind(e,"done")),e.audioSegmentStream.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),e.audioSegmentStream.on("timingInfo",e.trigger.bind(e,"audioTimingInfo")),e.adtsStream.pipe(e.audioSegmentStream),e.trigger("trackinfo",{hasAudio:!!e.tracks.audio,hasVideo:!!e.tracks.video}))}),e=a(e),e.metadataStream.on("data",e.trigger.bind(e,"id3Frame")),e},s=function(d,e){d.on("data",e.trigger.bind(e,"data")),d.on("done",e.trigger.bind(e,"done")),d.on("partialdone",e.trigger.bind(e,"partialdone")),d.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),d.on("audioTimingInfo",e.trigger.bind(e,"audioTimingInfo")),d.on("videoTimingInfo",e.trigger.bind(e,"videoTimingInfo")),d.on("trackinfo",e.trigger.bind(e,"trackinfo")),d.on("id3Frame",function(o){o.dispatchType=d.metadataStream.dispatchType,o.cueTime=c.videoTsToSeconds(o.pts),e.trigger("id3Frame",o)}),d.on("caption",function(o){e.trigger("caption",o)})},u=function n(d){var e=null,o=!0;d=d||{},n.prototype.init.call(this),d.baseMediaDecodeTime=d.baseMediaDecodeTime||0,this.push=function(x){if(o){var y=_(x);y&&(!e||e.type!=="aac")?(e=i(d),s(e,this)):!y&&(!e||e.type!=="ts")&&(e=l(d),s(e,this)),o=!1}e.headOfPipeline.push(x)},this.flush=function(){e&&(o=!0,e.headOfPipeline.flush())},this.partialFlush=function(){e&&e.headOfPipeline.partialFlush()},this.endTimeline=function(){e&&e.headOfPipeline.endTimeline()},this.reset=function(){e&&e.headOfPipeline.reset()},this.setBaseMediaDecodeTime=function(x){d.keepOriginalTimestamps||(d.baseMediaDecodeTime=x),e&&(e.tracks.audio&&(e.tracks.audio.timelineStartInfo.dts=void 0,e.tracks.audio.timelineStartInfo.pts=void 0,m.clearDtsInfo(e.tracks.audio),e.audioRollover&&e.audioRollover.discontinuity()),e.tracks.video&&(e.videoSegmentStream&&(e.videoSegmentStream.gopCache_=[]),e.tracks.video.timelineStartInfo.dts=void 0,e.tracks.video.timelineStartInfo.pts=void 0,m.clearDtsInfo(e.tracks.video)),e.timestampRollover&&e.timestampRollover.discontinuity())},this.setRemux=function(x){d.remux=x,e&&e.coalesceStream&&e.coalesceStream.setRemux(x)},this.setAudioAppendStart=function(x){!e||!e.tracks.audio||!e.audioSegmentStream||e.audioSegmentStream.setAudioAppendStart(x)},this.alignGopsWith=function(x){}};return u.prototype=new f,wt=u,wt}var Ft,tr;function gn(){return tr||(tr=1,Ft={Transmuxer:mn()}),Ft}var At,ir;function xn(){if(ir)return At;ir=1;var f=oe().getUint64,t=function(p){var h=new DataView(p.buffer,p.byteOffset,p.byteLength),m={version:p[0],flags:new Uint8Array(p.subarray(1,4)),references:[],referenceId:h.getUint32(4),timescale:h.getUint32(8)},_=12;m.version===0?(m.earliestPresentationTime=h.getUint32(_),m.firstOffset=h.getUint32(_+4),_+=8):(m.earliestPresentationTime=f(p.subarray(_)),m.firstOffset=f(p.subarray(_+8)),_+=16),_+=2;var v=h.getUint16(_);for(_+=2;v>0;_+=12,v--)m.references.push({referenceType:(p[_]&128)>>>7,referencedSize:h.getUint32(_)&2147483647,subsegmentDuration:h.getUint32(_+4),startsWithSap:!!(p[_+8]&128),sapType:(p[_+8]&112)>>>4,sapDeltaTime:h.getUint32(_+8)&268435455});return m};return At=t,At}var Pt,rr;function vn(){if(rr)return Pt;rr=1;var f=oe();f.MAX_UINT32;var t=f.getUint64,r,p,h=function(a){return new Date(a*1e3-20828448e5)},m=Vt(),_=zt(),v=function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength),i=[],s,u;for(s=0;s+4<a.length;s+=u){if(u=l.getUint32(s),s+=4,u<=0){i.push("<span style='color:red;'>MALFORMED DATA</span>");continue}switch(a[s]&31){case 1:i.push("slice_layer_without_partitioning_rbsp");break;case 5:i.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:i.push("sei_rbsp");break;case 7:i.push("seq_parameter_set_rbsp");break;case 8:i.push("pic_parameter_set_rbsp");break;case 9:i.push("access_unit_delimiter_rbsp");break;default:i.push("UNKNOWN NAL - "+a[s]&31);break}}return i},g={avc1:function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength);return{dataReferenceIndex:l.getUint16(6),width:l.getUint16(24),height:l.getUint16(26),horizresolution:l.getUint16(28)+l.getUint16(30)/16,vertresolution:l.getUint16(32)+l.getUint16(34)/16,frameCount:l.getUint16(40),depth:l.getUint16(74),config:r(a.subarray(78,a.byteLength))}},avcC:function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength),i={configurationVersion:a[0],avcProfileIndication:a[1],profileCompatibility:a[2],avcLevelIndication:a[3],lengthSizeMinusOne:a[4]&3,sps:[],pps:[]},s=a[5]&31,u,n,d,e;for(d=6,e=0;e<s;e++)n=l.getUint16(d),d+=2,i.sps.push(new Uint8Array(a.subarray(d,d+n))),d+=n;for(u=a[d],d++,e=0;e<u;e++)n=l.getUint16(d),d+=2,i.pps.push(new Uint8Array(a.subarray(d,d+n))),d+=n;return i},btrt:function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength);return{bufferSizeDB:l.getUint32(0),maxBitrate:l.getUint32(4),avgBitrate:l.getUint32(8)}},edts:function(a){return{boxes:r(a)}},elst:function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength),i={version:l.getUint8(0),flags:new Uint8Array(a.subarray(1,4)),edits:[]},s=l.getUint32(4),u;for(u=8;s;s--)i.version===0?(i.edits.push({segmentDuration:l.getUint32(u),mediaTime:l.getInt32(u+4),mediaRate:l.getUint16(u+8)+l.getUint16(u+10)/(256*256)}),u+=12):(i.edits.push({segmentDuration:t(a.subarray(u)),mediaTime:t(a.subarray(u+8)),mediaRate:l.getUint16(u+16)+l.getUint16(u+18)/(256*256)}),u+=20);return i},esds:function(a){return{version:a[0],flags:new Uint8Array(a.subarray(1,4)),esId:a[6]<<8|a[7],streamPriority:a[8]&31,decoderConfig:{objectProfileIndication:a[11],streamType:a[12]>>>2&63,bufferSize:a[13]<<16|a[14]<<8|a[15],maxBitrate:a[16]<<24|a[17]<<16|a[18]<<8|a[19],avgBitrate:a[20]<<24|a[21]<<16|a[22]<<8|a[23],decoderConfigDescriptor:{tag:a[24],length:a[25],audioObjectType:a[26]>>>3&31,samplingFrequencyIndex:(a[26]&7)<<1|a[27]>>>7&1,channelConfiguration:a[27]>>>3&15}}}},ftyp:function(a){for(var l=new DataView(a.buffer,a.byteOffset,a.byteLength),i={majorBrand:m(a.subarray(0,4)),minorVersion:l.getUint32(4),compatibleBrands:[]},s=8;s<a.byteLength;)i.compatibleBrands.push(m(a.subarray(s,s+4))),s+=4;return i},dinf:function(a){return{boxes:r(a)}},dref:function(a){return{version:a[0],flags:new Uint8Array(a.subarray(1,4)),dataReferences:r(a.subarray(8))}},hdlr:function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength),i={version:l.getUint8(0),flags:new Uint8Array(a.subarray(1,4)),handlerType:m(a.subarray(8,12)),name:""},s=8;for(s=24;s<a.byteLength;s++){if(a[s]===0){s++;break}i.name+=String.fromCharCode(a[s])}return i.name=decodeURIComponent(escape(i.name)),i},mdat:function(a){return{byteLength:a.byteLength,nals:v(a)}},mdhd:function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength),i=4,s,u={version:l.getUint8(0),flags:new Uint8Array(a.subarray(1,4)),language:""};return u.version===1?(i+=4,u.creationTime=h(l.getUint32(i)),i+=8,u.modificationTime=h(l.getUint32(i)),i+=4,u.timescale=l.getUint32(i),i+=8,u.duration=l.getUint32(i)):(u.creationTime=h(l.getUint32(i)),i+=4,u.modificationTime=h(l.getUint32(i)),i+=4,u.timescale=l.getUint32(i),i+=4,u.duration=l.getUint32(i)),i+=4,s=l.getUint16(i),u.language+=String.fromCharCode((s>>10)+96),u.language+=String.fromCharCode(((s&992)>>5)+96),u.language+=String.fromCharCode((s&31)+96),u},mdia:function(a){return{boxes:r(a)}},mfhd:function(a){return{version:a[0],flags:new Uint8Array(a.subarray(1,4)),sequenceNumber:a[4]<<24|a[5]<<16|a[6]<<8|a[7]}},minf:function(a){return{boxes:r(a)}},mp4a:function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength),i={dataReferenceIndex:l.getUint16(6),channelcount:l.getUint16(16),samplesize:l.getUint16(18),samplerate:l.getUint16(24)+l.getUint16(26)/65536};return a.byteLength>28&&(i.streamDescriptor=r(a.subarray(28))[0]),i},moof:function(a){return{boxes:r(a)}},moov:function(a){return{boxes:r(a)}},mvex:function(a){return{boxes:r(a)}},mvhd:function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength),i=4,s={version:l.getUint8(0),flags:new Uint8Array(a.subarray(1,4))};return s.version===1?(i+=4,s.creationTime=h(l.getUint32(i)),i+=8,s.modificationTime=h(l.getUint32(i)),i+=4,s.timescale=l.getUint32(i),i+=8,s.duration=l.getUint32(i)):(s.creationTime=h(l.getUint32(i)),i+=4,s.modificationTime=h(l.getUint32(i)),i+=4,s.timescale=l.getUint32(i),i+=4,s.duration=l.getUint32(i)),i+=4,s.rate=l.getUint16(i)+l.getUint16(i+2)/16,i+=4,s.volume=l.getUint8(i)+l.getUint8(i+1)/8,i+=2,i+=2,i+=2*4,s.matrix=new Uint32Array(a.subarray(i,i+9*4)),i+=9*4,i+=6*4,s.nextTrackId=l.getUint32(i),s},pdin:function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength);return{version:l.getUint8(0),flags:new Uint8Array(a.subarray(1,4)),rate:l.getUint32(4),initialDelay:l.getUint32(8)}},sdtp:function(a){var l={version:a[0],flags:new Uint8Array(a.subarray(1,4)),samples:[]},i;for(i=4;i<a.byteLength;i++)l.samples.push({dependsOn:(a[i]&48)>>4,isDependedOn:(a[i]&12)>>2,hasRedundancy:a[i]&3});return l},sidx:xn(),smhd:function(a){return{version:a[0],flags:new Uint8Array(a.subarray(1,4)),balance:a[4]+a[5]/256}},stbl:function(a){return{boxes:r(a)}},ctts:function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength),i={version:l.getUint8(0),flags:new Uint8Array(a.subarray(1,4)),compositionOffsets:[]},s=l.getUint32(4),u;for(u=8;s;u+=8,s--)i.compositionOffsets.push({sampleCount:l.getUint32(u),sampleOffset:l[i.version===0?"getUint32":"getInt32"](u+4)});return i},stss:function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength),i={version:l.getUint8(0),flags:new Uint8Array(a.subarray(1,4)),syncSamples:[]},s=l.getUint32(4),u;for(u=8;s;u+=4,s--)i.syncSamples.push(l.getUint32(u));return i},stco:function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength),i={version:a[0],flags:new Uint8Array(a.subarray(1,4)),chunkOffsets:[]},s=l.getUint32(4),u;for(u=8;s;u+=4,s--)i.chunkOffsets.push(l.getUint32(u));return i},stsc:function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength),i=l.getUint32(4),s={version:a[0],flags:new Uint8Array(a.subarray(1,4)),sampleToChunks:[]},u;for(u=8;i;u+=12,i--)s.sampleToChunks.push({firstChunk:l.getUint32(u),samplesPerChunk:l.getUint32(u+4),sampleDescriptionIndex:l.getUint32(u+8)});return s},stsd:function(a){return{version:a[0],flags:new Uint8Array(a.subarray(1,4)),sampleDescriptions:r(a.subarray(8))}},stsz:function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength),i={version:a[0],flags:new Uint8Array(a.subarray(1,4)),sampleSize:l.getUint32(4),entries:[]},s;for(s=12;s<a.byteLength;s+=4)i.entries.push(l.getUint32(s));return i},stts:function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength),i={version:a[0],flags:new Uint8Array(a.subarray(1,4)),timeToSamples:[]},s=l.getUint32(4),u;for(u=8;s;u+=8,s--)i.timeToSamples.push({sampleCount:l.getUint32(u),sampleDelta:l.getUint32(u+4)});return i},styp:function(a){return g.ftyp(a)},tfdt:Ht(),tfhd:Gt(),tkhd:function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength),i=4,s={version:l.getUint8(0),flags:new Uint8Array(a.subarray(1,4))};return s.version===1?(i+=4,s.creationTime=h(l.getUint32(i)),i+=8,s.modificationTime=h(l.getUint32(i)),i+=4,s.trackId=l.getUint32(i),i+=4,i+=8,s.duration=l.getUint32(i)):(s.creationTime=h(l.getUint32(i)),i+=4,s.modificationTime=h(l.getUint32(i)),i+=4,s.trackId=l.getUint32(i),i+=4,i+=4,s.duration=l.getUint32(i)),i+=4,i+=2*4,s.layer=l.getUint16(i),i+=2,s.alternateGroup=l.getUint16(i),i+=2,s.volume=l.getUint8(i)+l.getUint8(i+1)/8,i+=2,i+=2,s.matrix=new Uint32Array(a.subarray(i,i+9*4)),i+=9*4,s.width=l.getUint16(i)+l.getUint16(i+2)/65536,i+=4,s.height=l.getUint16(i)+l.getUint16(i+2)/65536,s},traf:function(a){return{boxes:r(a)}},trak:function(a){return{boxes:r(a)}},trex:function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength);return{version:a[0],flags:new Uint8Array(a.subarray(1,4)),trackId:l.getUint32(4),defaultSampleDescriptionIndex:l.getUint32(8),defaultSampleDuration:l.getUint32(12),defaultSampleSize:l.getUint32(16),sampleDependsOn:a[20]&3,sampleIsDependedOn:(a[21]&192)>>6,sampleHasRedundancy:(a[21]&48)>>4,samplePaddingValue:(a[21]&14)>>1,sampleIsDifferenceSample:!!(a[21]&1),sampleDegradationPriority:l.getUint16(22)}},trun:Wt(),"url ":function(a){return{version:a[0],flags:new Uint8Array(a.subarray(1,4))}},vmhd:function(a){var l=new DataView(a.buffer,a.byteOffset,a.byteLength);return{version:a[0],flags:new Uint8Array(a.subarray(1,4)),graphicsmode:l.getUint16(4),opcolor:new Uint16Array([l.getUint16(6),l.getUint16(8),l.getUint16(10)])}}};return r=function(a){for(var l=0,i=[],s,u,n,d,e,o=new ArrayBuffer(a.length),x=new Uint8Array(o),y=0;y<a.length;++y)x[y]=a[y];for(s=new DataView(o);l<a.byteLength;)u=s.getUint32(l),n=m(a.subarray(l+4,l+8)),d=u>1?l+u:a.byteLength,e=(g[n]||function(b){return{data:b}})(a.subarray(l+8,d)),e.size=u,e.type=n,i.push(e),l=d;return i},p=function(a,l){var i;return l=l||0,i=new Array(l*2+1).join(" "),a.map(function(s,u){return i+s.type+`
`+Object.keys(s).filter(function(n){return n!=="type"&&n!=="boxes"}).map(function(n){var d=i+"  "+n+": ",e=s[n];if(e instanceof Uint8Array||e instanceof Uint32Array){var o=Array.prototype.slice.call(new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).map(function(x){return" "+("00"+x.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return o?o.length===1?d+"<"+o.join("").slice(1)+">":d+`<
`+o.map(function(x){return i+"  "+x}).join(`
`)+`
`+i+"  >":d+"<>"}return d+JSON.stringify(e,null,2).split(`
`).map(function(x,y){return y===0?x:i+"  "+x}).join(`
`)}).join(`
`)+(s.boxes?`
`+p(s.boxes,l+1):"")}).join(`
`)},Pt={inspect:r,textify:p,parseType:m,findBox:_,parseTraf:g.traf,parseTfdt:g.tfdt,parseHdlr:g.hdlr,parseTfhd:g.tfhd,parseTrun:g.trun,parseSidx:g.sidx},Pt}var Dt,nr;function _n(){if(nr)return Dt;nr=1;var f={8:"audio",9:"video",18:"metadata"},t=function(i){return"0x"+("00"+i.toString(16)).slice(-2).toUpperCase()},r=function(i){for(var s=[],u;i.byteLength>0;)u=0,s.push(t(i[u++])),i=i.subarray(u);return s.join(" ")},p=function(i,s){var u=["AVC Sequence Header","AVC NALU","AVC End-of-Sequence"],n=i[1]&parseInt("01111111",2)<<16|i[2]<<8|i[3];return s=s||{},s.avcPacketType=u[i[0]],s.CompositionTime=i[1]&parseInt("10000000",2)?-n:n,i[0]===1?s.nalUnitTypeRaw=r(i.subarray(4,100)):s.data=r(i.subarray(4)),s},h=function(i,s){var u=["Unknown","Keyframe (for AVC, a seekable frame)","Inter frame (for AVC, a nonseekable frame)","Disposable inter frame (H.263 only)","Generated keyframe (reserved for server use only)","Video info/command frame"],n=i[0]&parseInt("00001111",2);return s=s||{},s.frameType=u[(i[0]&parseInt("11110000",2))>>>4],s.codecID=n,n===7?p(i.subarray(1),s):s},m=function(i,s){var u=["AAC Sequence Header","AAC Raw"];return s=s||{},s.aacPacketType=u[i[0]],s.data=r(i.subarray(1)),s},_=function(i,s){var u=["Linear PCM, platform endian","ADPCM","MP3","Linear PCM, little endian","Nellymoser 16-kHz mono","Nellymoser 8-kHz mono","Nellymoser","G.711 A-law logarithmic PCM","G.711 mu-law logarithmic PCM","reserved","AAC","Speex","MP3 8-Khz","Device-specific sound"],n=["5.5-kHz","11-kHz","22-kHz","44-kHz"],d=(i[0]&parseInt("11110000",2))>>>4;return s=s||{},s.soundFormat=u[d],s.soundRate=n[(i[0]&parseInt("00001100",2))>>>2],s.soundSize=(i[0]&parseInt("00000010",2))>>>1?"16-bit":"8-bit",s.soundType=i[0]&parseInt("00000001",2)?"Stereo":"Mono",d===10?m(i.subarray(1),s):s},v=function(i){return{tagType:f[i[0]],dataSize:i[1]<<16|i[2]<<8|i[3],timestamp:i[7]<<24|i[4]<<16|i[5]<<8|i[6],streamID:i[8]<<16|i[9]<<8|i[10]}},g=function(i){var s=v(i);switch(i[0]){case 8:_(i.subarray(11),s);break;case 9:h(i.subarray(11),s);break}return s},c=function(i){var s=9,u,n=[],d;for(s+=4;s<i.byteLength;)u=i[s+1]<<16,u|=i[s+2]<<8,u|=i[s+3],u+=11,d=i.subarray(s,s+u),n.push(g(d)),s+=u+4;return n},a=function(i){return JSON.stringify(i,null,2)};return Dt={inspectTag:g,inspect:c,textify:a},Dt}var Ut,ar;function yn(){if(ar)return Ut;ar=1;var f=Te(),t=function(i){var s=i[1]&31;return s<<=8,s|=i[2],s},r=function(i){return!!(i[1]&64)},p=function(i){var s=0;return(i[3]&48)>>>4>1&&(s+=i[4]+1),s},h=function(i,s){var u=t(i);return u===0?"pat":u===s?"pmt":s?"pes":null},m=function(i){var s=r(i),u=4+p(i);return s&&(u+=i[u]+1),(i[u+10]&31)<<8|i[u+11]},_=function(i){var s={},u=r(i),n=4+p(i);if(u&&(n+=i[n]+1),!!(i[n+5]&1)){var d,e,o;d=(i[n+1]&15)<<8|i[n+2],e=3+d-4,o=(i[n+10]&15)<<8|i[n+11];for(var x=12+o;x<e;){var y=n+x;s[(i[y+1]&31)<<8|i[y+2]]=i[y],x+=((i[y+3]&15)<<8|i[y+4])+5}return s}},v=function(i,s){var u=t(i),n=s[u];switch(n){case f.H264_STREAM_TYPE:return"video";case f.ADTS_STREAM_TYPE:return"audio";case f.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},g=function(i){var s=r(i);if(!s)return null;var u=4+p(i);if(u>=i.byteLength)return null;var n=null,d;return d=i[u+7],d&192&&(n={},n.pts=(i[u+9]&14)<<27|(i[u+10]&255)<<20|(i[u+11]&254)<<12|(i[u+12]&255)<<5|(i[u+13]&254)>>>3,n.pts*=4,n.pts+=(i[u+13]&6)>>>1,n.dts=n.pts,d&64&&(n.dts=(i[u+14]&14)<<27|(i[u+15]&255)<<20|(i[u+16]&254)<<12|(i[u+17]&255)<<5|(i[u+18]&254)>>>3,n.dts*=4,n.dts+=(i[u+18]&6)>>>1)),n},c=function(i){switch(i){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},a=function(i){for(var s=4+p(i),u=i.subarray(s),n=0,d=0,e=!1,o;d<u.byteLength-3;d++)if(u[d+2]===1){n=d+5;break}for(;n<u.byteLength;)switch(u[n]){case 0:if(u[n-1]!==0){n+=2;break}else if(u[n-2]!==0){n++;break}d+3!==n-2&&(o=c(u[d+3]&31),o==="slice_layer_without_partitioning_rbsp_idr"&&(e=!0));do n++;while(u[n]!==1&&n<u.length);d=n-2,n+=3;break;case 1:if(u[n-1]!==0||u[n-2]!==0){n+=3;break}o=c(u[d+3]&31),o==="slice_layer_without_partitioning_rbsp_idr"&&(e=!0),d=n-2,n+=3;break;default:n+=3;break}return u=u.subarray(d),n-=d,d=0,u&&u.byteLength>3&&(o=c(u[d+3]&31),o==="slice_layer_without_partitioning_rbsp_idr"&&(e=!0)),e};return Ut={parseType:h,parsePat:m,parsePmt:_,parsePayloadUnitStartIndicator:r,parsePesType:v,parsePesTime:g,videoPacketContainsKeyFrame:a},Ut}var It,sr;function Sn(){if(sr)return It;sr=1;var f=Te(),t=Cr().handleRollover,r={};r.ts=yn(),r.aac=Fe();var p=ie().ONE_SECOND_IN_TS,h=188,m=71,_=function(u,n){for(var d=0,e=h,o,x;e<u.byteLength;){if(u[d]===m&&u[e]===m){switch(o=u.subarray(d,e),x=r.ts.parseType(o,n.pid),x){case"pat":n.pid=r.ts.parsePat(o);break;case"pmt":var y=r.ts.parsePmt(o);n.table=n.table||{},Object.keys(y).forEach(function(b){n.table[b]=y[b]});break}d+=h,e+=h;continue}d++,e++}},v=function(u,n,d){for(var e=0,o=h,x,y,b,F,S,w=!1;o<=u.byteLength;){if(u[e]===m&&(u[o]===m||o===u.byteLength)){switch(x=u.subarray(e,o),y=r.ts.parseType(x,n.pid),y){case"pes":b=r.ts.parsePesType(x,n.table),F=r.ts.parsePayloadUnitStartIndicator(x),b==="audio"&&F&&(S=r.ts.parsePesTime(x),S&&(S.type="audio",d.audio.push(S),w=!0));break}if(w)break;e+=h,o+=h;continue}e++,o++}for(o=u.byteLength,e=o-h,w=!1;e>=0;){if(u[e]===m&&(u[o]===m||o===u.byteLength)){switch(x=u.subarray(e,o),y=r.ts.parseType(x,n.pid),y){case"pes":b=r.ts.parsePesType(x,n.table),F=r.ts.parsePayloadUnitStartIndicator(x),b==="audio"&&F&&(S=r.ts.parsePesTime(x),S&&(S.type="audio",d.audio.push(S),w=!0));break}if(w)break;e-=h,o-=h;continue}e--,o--}},g=function(u,n,d){for(var e=0,o=h,x,y,b,F,S,w,A,C,I=!1,T={data:[],size:0};o<u.byteLength;){if(u[e]===m&&u[o]===m){switch(x=u.subarray(e,o),y=r.ts.parseType(x,n.pid),y){case"pes":if(b=r.ts.parsePesType(x,n.table),F=r.ts.parsePayloadUnitStartIndicator(x),b==="video"&&(F&&!I&&(S=r.ts.parsePesTime(x),S&&(S.type="video",d.video.push(S),I=!0)),!d.firstKeyFrame)){if(F&&T.size!==0){for(w=new Uint8Array(T.size),A=0;T.data.length;)C=T.data.shift(),w.set(C,A),A+=C.byteLength;if(r.ts.videoPacketContainsKeyFrame(w)){var U=r.ts.parsePesTime(w);U?(d.firstKeyFrame=U,d.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}T.size=0}T.data.push(x),T.size+=x.byteLength}break}if(I&&d.firstKeyFrame)break;e+=h,o+=h;continue}e++,o++}for(o=u.byteLength,e=o-h,I=!1;e>=0;){if(u[e]===m&&u[o]===m){switch(x=u.subarray(e,o),y=r.ts.parseType(x,n.pid),y){case"pes":b=r.ts.parsePesType(x,n.table),F=r.ts.parsePayloadUnitStartIndicator(x),b==="video"&&F&&(S=r.ts.parsePesTime(x),S&&(S.type="video",d.video.push(S),I=!0));break}if(I)break;e-=h,o-=h;continue}e--,o--}},c=function(u,n){if(u.audio&&u.audio.length){var d=n;(typeof d>"u"||isNaN(d))&&(d=u.audio[0].dts),u.audio.forEach(function(x){x.dts=t(x.dts,d),x.pts=t(x.pts,d),x.dtsTime=x.dts/p,x.ptsTime=x.pts/p})}if(u.video&&u.video.length){var e=n;if((typeof e>"u"||isNaN(e))&&(e=u.video[0].dts),u.video.forEach(function(x){x.dts=t(x.dts,e),x.pts=t(x.pts,e),x.dtsTime=x.dts/p,x.ptsTime=x.pts/p}),u.firstKeyFrame){var o=u.firstKeyFrame;o.dts=t(o.dts,e),o.pts=t(o.pts,e),o.dtsTime=o.dts/p,o.ptsTime=o.pts/p}}},a=function(u){for(var n=!1,d=0,e=null,o=null,x=0,y=0,b;u.length-y>=3;){var F=r.aac.parseType(u,y);switch(F){case"timed-metadata":if(u.length-y<10){n=!0;break}if(x=r.aac.parseId3TagSize(u,y),x>u.length){n=!0;break}o===null&&(b=u.subarray(y,y+x),o=r.aac.parseAacTimestamp(b)),y+=x;break;case"audio":if(u.length-y<7){n=!0;break}if(x=r.aac.parseAdtsSize(u,y),x>u.length){n=!0;break}e===null&&(b=u.subarray(y,y+x),e=r.aac.parseSampleRate(b)),d++,y+=x;break;default:y++;break}if(n)return null}if(e===null||o===null)return null;var S=p/e,w={audio:[{type:"audio",dts:o,pts:o},{type:"audio",dts:o+d*1024*S,pts:o+d*1024*S}]};return w},l=function(u){var n={pid:null,table:null},d={};_(u,n);for(var e in n.table)if(n.table.hasOwnProperty(e)){var o=n.table[e];switch(o){case f.H264_STREAM_TYPE:d.video=[],g(u,n,d),d.video.length===0&&delete d.video;break;case f.ADTS_STREAM_TYPE:d.audio=[],v(u,n,d),d.audio.length===0&&delete d.audio;break}}return d},i=function(u,n){var d=r.aac.isLikelyAacData(u),e;return d?e=a(u):e=l(u),!e||!e.audio&&!e.video?null:(c(e,n),e)};return It={inspect:i,parseAudioPes_:v},It}var Ct,or;function bn(){if(or)return Ct;or=1;var f={codecs:wr(),mp4:sn(),flv:fn(),mp2t:hn(),partial:gn()};return f.mp4.tools=vn(),f.flv.tools=_n(),f.mp2t.tools=Sn(),Ct=f,Ct}var Tn=bn();const wn=Kr(Tn);class Fn{constructor(t,r,p,h){q(this,"transmuxer");q(this,"video");q(this,"duration");q(this,"mediaSource");q(this,"sourceBuffer");q(this,"codecs");q(this,"segmentQueue",[]);q(this,"isAppending",!1);q(this,"segmentUrls",[]);q(this,"currentSegmentIndex",0);q(this,"bufferMonitorInterval",null);q(this,"isFetching",!1);q(this,"networkManager");q(this,"requestedSegments",new Set);q(this,"onSeeking",()=>{const t=this.video.currentTime;console.log("Seeking to:",t),this.isTimeInBuffered(t)?console.log("Seeked to a time already buffered, skipping fetch"):this.clearBuffer().then(()=>{this.requestedSegments.clear();const p=Math.floor(t/3);this.currentSegmentIndex=p,this.fetchAndProcessNextSegment()})});this.video=t,this.mediaSource=new MediaSource,this.video.src=URL.createObjectURL(this.mediaSource),this.duration=r,this.codecs=p,this.networkManager=h,this.transmuxer=new wn.mp4.Transmuxer,this.transmuxer.on("data",m=>{const _=new Uint8Array(m.initSegment.byteLength+m.data.byteLength);_.set(m.initSegment,0),_.set(m.data,m.initSegment.byteLength),this.queueSegment(_)}),this.setup()}setup(){this.mediaSource.addEventListener("sourceopen",()=>{console.log("MediaSource opened"),this.initSourceBuffer(),this.duration&&(this.mediaSource.duration=this.duration,console.log("MediaSource duration set to:",this.duration)),this.startBufferMonitor()}),this.video.addEventListener("seeking",this.onSeeking)}reset(){if(console.log("Resetting engine state"),this.stopBufferMonitor(),this.sourceBuffer)try{this.mediaSource.removeSourceBuffer(this.sourceBuffer)}catch(t){console.warn("Failed to remove SourceBuffer:",t)}if(this.mediaSource.readyState==="open")try{this.mediaSource.endOfStream()}catch(t){console.warn("Failed to end MediaSource stream:",t)}this.mediaSource=new MediaSource,this.video.src=URL.createObjectURL(this.mediaSource),this.setup(),this.clearBuffer().then(()=>{this.requestedSegments.clear(),this.currentSegmentIndex=0,this.segmentQueue=[],this.isAppending=!1})}destroy(){this.stopBufferMonitor(),this.video.removeEventListener("seeking",this.onSeeking),this.mediaSource.readyState==="open"&&this.mediaSource.endOfStream(),URL.revokeObjectURL(this.video.src)}loadSegments(t,r){this.segmentUrls=t,this.currentSegmentIndex=Math.floor(r/3),this.fetchAndProcessNextSegment()}getBufferedLength(t){const r=this.video.buffered;for(let p=0;p<r.length;p++){const h=r.start(p),m=r.end(p);if(t>=h&&t<=m)return m-t}return 0}clearBuffer(){return new Promise(t=>{if(!this.sourceBuffer){console.warn("No SourceBuffer to clear"),t();return}if(!Array.from(this.mediaSource.sourceBuffers).some(h=>h===this.sourceBuffer)){console.error("SourceBuffer is no longer valid"),t();return}const p=()=>{if(!this.sourceBuffer||this.sourceBuffer.updating){setTimeout(p,50);return}try{const h=this.sourceBuffer.buffered,m=this.video.currentTime;if(h.length===0){this.requestedSegments.clear(),t();return}const _=()=>{this.sourceBuffer.removeEventListener("updateend",_),this.requestedSegments.clear(),t()};this.sourceBuffer.addEventListener("updateend",_);for(let v=0;v<h.length;v++){const g=h.start(v),c=h.end(v);(c<m||g>m+5)&&this.sourceBuffer.remove(g,c)}}catch(h){console.warn("Failed to clear buffer:",h),t()}};p()})}initSourceBuffer(){let t=null;for(const r of this.codecs){console.log("Checking codec support for:",r);const p=`video/mp4; codecs="${r}"`;if(MediaSource.isTypeSupported(p)){t=p;break}}if(!t){console.error("No supported codecs found:",this.codecs);return}try{this.sourceBuffer=this.mediaSource.addSourceBuffer(t),this.sourceBuffer.mode="segments",this.sourceBuffer.addEventListener("updateend",()=>{this.isAppending=!1,this.processQueue()}),this.sourceBuffer.addEventListener("error",r=>{console.error("SourceBuffer Error:",r)})}catch(r){console.error("Error creating SourceBuffer:",r)}}async fetchSegment(t){const r=performance.now(),p=await fetch(t),h=new Uint8Array(await p.arrayBuffer()),_=performance.now()-r,v=h.byteLength;return this.networkManager&&this.networkManager.onSegmentDownloaded({durationSec:3,sizeBytes:v,downloadTimeMs:_,url:t}),h}async fetchSegments(t,r){const p=this.segmentUrls.slice(t,t+r),h=[];for(let m=0;m<p.length;m++){const _=t+m;if(this.requestedSegments.has(_))continue;const v=p[m];try{const g=await this.fetchSegment(v);this.requestedSegments.add(_),h.push(g)}catch(g){console.error("Error fetching segment:",g)}}return h}async fetchAndProcessNextSegment(){if(this.isFetching)return;this.isFetching=!0;const t=3,r=this.currentSegmentIndex,p=await this.fetchSegments(r,t);for(const h of p)this.transmuxer.push(h),this.transmuxer.flush();this.currentSegmentIndex+=t,this.isFetching=!1}queueSegment(t){if(!this.sourceBuffer){this.segmentQueue.push(t);return}this.segmentQueue.push(t),this.processQueue()}processQueue(){if(!this.sourceBuffer||this.isAppending||this.sourceBuffer.updating||this.segmentQueue.length===0)return;if(!Array.from(this.mediaSource.sourceBuffers).some(p=>p===this.sourceBuffer)){console.error("SourceBuffer is no longer valid");return}const r=this.segmentQueue.shift();if(r){this.isAppending=!0;try{this.sourceBuffer.appendBuffer(r)}catch(p){console.error("Error appending buffer:",p),this.isAppending=!1}}}isTimeInBuffered(t){const r=this.video.buffered;for(let p=0;p<r.length;p++)if(t>=r.start(p)&&t<=r.end(p))return!0;return!1}startBufferMonitor(){this.bufferMonitorInterval===null&&(this.bufferMonitorInterval=window.setInterval(()=>{(this.video.buffered.length?this.video.buffered.end(this.video.buffered.length-1):0)-this.video.currentTime<5&&!this.isAppending&&(console.log("Buffer low  fetching more segments..."),this.fetchAndProcessNextSegment())},1e3))}stopBufferMonitor(){this.bufferMonitorInterval!==null&&(clearInterval(this.bufferMonitorInterval),this.bufferMonitorInterval=null)}}const An=async f=>{const p=(await(await fetch(f)).text()).split(`
`).map(m=>m.trim()),h=[];for(let m=0;m<p.length;m++)if(p[m].startsWith("#EXT-X-STREAM-INF")){const _=p[m].match(/BANDWIDTH=(\d+)/),v=p[m].match(/RESOLUTION=(\d+x\d+)/),g=p[m].match(/CODECS="([^"]+)"/),c=p[m+1];if(_&&v&&f){const a=new URL(c,f).href;h.push({bandwidth:parseInt(_[1],10),resolution:v[1],url:a,totalDuration:0,codecs:g?g[1].split(","):[]})}}return console.log("Available renditions:",h),h},ue=new Map,Ae=async f=>{if(ue.has(f))return console.log(`Using cached playlist for URL: ${f}`),ue.get(f);const t=await fetch(f);if(!t.ok)throw new Error(`Failed to fetch playlist: ${f}`);const p=(await t.text()).split(`
`).map(h=>h.trim());return ue.set(f,p),console.log(`Cached playlist for URL: ${f}`),p},Pn=()=>{console.log("Clearing playlist cache"),ue.clear()},Dn=f=>{let t=0;for(const r of f)if(r.startsWith("#EXTINF")){const p=r.match(/#EXTINF:([\d.]+)/);p&&(t+=parseFloat(p[1]))}return t},Pe=async(f,t)=>{const r=[];for(const p of f)p&&!p.startsWith("#")&&r.push(new URL(p,t).href);return ue.set(t,r),console.log(`Cached playlist for URL: ${t}`),{segmentUrls:r,totalDuration:Dn(f)}},Un=({renditions:f,onSelect:t})=>X("div",{className:"quality-selector",children:f.map((r,p)=>X("button",{onClick:()=>t(p),children:r.resolution},r.resolution))});class ur{constructor(){q(this,"currentIndex",0);q(this,"manualIndex",null);q(this,"videoEl");q(this,"renditions");q(this,"engine");q(this,"playlistCache",new Map)}initialize(t,r,p,h){this.videoEl=t,this.renditions=r,this.engine=p,console.log("FixedQualityAbrManager initialized:",r)}destroy(){console.log("FixedQualityAbrManager destroyed")}getRendition(){return this.renditions[this.currentIndex]}selectRendition(){return this.manualIndex??this.currentIndex}setManualRendition(t){this.manualIndex=t,this.updateSelectedIndex(t)}clearManualRendition(){this.manualIndex=null}onPlaybackStall(){}async updateSelectedIndex(t){if(this.currentIndex===t)return;this.currentIndex=t;const r=this.renditions[this.currentIndex];console.log(`Switching to ${r.resolution}`);let p=this.playlistCache.get(r.url);if(!p){const h=await Ae(r.url),{segmentUrls:m}=await Pe(h,r.url);p=m,this.playlistCache.set(r.url,p)}await this.engine.clearBuffer(),this.engine.requestedSegments.clear(),this.engine.loadSegments(p,this.videoEl.currentTime)}}class In{constructor(){q(this,"videoEl");q(this,"renditions");q(this,"engine");q(this,"currentIndex",0);q(this,"manualIndex",null);q(this,"interval")}initialize(t,r,p,h){this.videoEl=t,this.renditions=r.sort((m,_)=>m.bandwidth-_.bandwidth),this.engine=p,this.currentIndex=0,console.log("BufferBasedAbrManager initialized"),this.interval=window.setInterval(()=>this.checkBufferAndSwitch(),1e3)}destroy(){this.interval&&(clearInterval(this.interval),this.interval=void 0),console.log("BufferBasedAbrManager destroyed")}getRendition(){return this.renditions[this.currentIndex]}selectRendition(){return this.manualIndex??this.currentIndex}setManualRendition(t){this.manualIndex=t,this.loadRendition(t)}clearManualRendition(){this.manualIndex=null}onPlaybackStall(){}async checkBufferAndSwitch(){if(this.manualIndex!==null)return;const t=this.engine.getBufferedLength(this.videoEl.currentTime);console.log(`Buffer length: ${t}, Current resolution: ${this.renditions[this.currentIndex].resolution}`),t<3&&this.currentIndex>0?(this.currentIndex--,await this.loadRendition(this.currentIndex)):t>3&&this.currentIndex<this.renditions.length-1&&(this.currentIndex++,await this.loadRendition(this.currentIndex))}async loadRendition(t){const r=this.renditions[t];console.log("Loading rendition:",r);const p=await Ae(r.url),{segmentUrls:h}=await Pe(p,r.url);await this.engine.clearBuffer(),this.engine.requestedSegments.clear(),this.engine.loadSegments(h,this.videoEl.currentTime)}}class Cn{constructor(){q(this,"renditions",[]);q(this,"videoEl");q(this,"engine");q(this,"manualIndex",null);q(this,"networkManager");q(this,"bandwidthSafetyMargin",1.1);q(this,"currentIndex",0);q(this,"interval")}initialize(t,r,p,h){this.videoEl=t,this.renditions=r,this.engine=p,this.networkManager=h,this.renditions=[...r].sort((_,v)=>_.bandwidth-v.bandwidth);const m=this.selectRendition();this.currentIndex=m,this.loadRendition(m),this.videoEl.addEventListener("timeupdate",()=>{if(!this.networkManager.getBandwidthEstimate()){console.warn("No bandwidth estimate available");return}const v=this.selectRendition();v!==this.currentIndex&&(console.log(`Switching to rendition: ${this.renditions[v].resolution}`),this.loadRendition(v))})}selectRendition(){if(this.manualIndex!==null)return this.manualIndex;const t=this.networkManager.getBandwidthEstimate(),r=t/this.bandwidthSafetyMargin;let p=0;for(let v=0;v<this.renditions.length&&this.renditions[v].bandwidth<=r;v++)p=v;const h=this.renditions[this.currentIndex],m=t<h.bandwidth*.9&&p<this.currentIndex,_=t>h.bandwidth*1.1&&p>this.currentIndex;return console.log({estimatedBps:t,safeBps:r,currentBandwidth:h.bandwidth,bestIndex:p,currentIndex:this.currentIndex,shouldDownswitch:m,shouldUpswitch:_}),m?(console.log(`Downswitching: Bandwidth (${t}) << Current (${h.bandwidth})`),p):_?(console.log(`Upswitching: Bandwidth (${t}) >> Current (${h.bandwidth})`),p):this.currentIndex}getRendition(){return this.renditions[this.currentIndex]}setManualRendition(t){this.manualIndex=t}clearManualRendition(){this.manualIndex=null,console.log("Manual rendition cleared, resuming automatic selection");const t=this.selectRendition();t!==this.currentIndex&&(console.log(`Switching to rendition: ${this.renditions[t].resolution}`),this.loadRendition(t))}onPlaybackStall(){const t=this.selectRendition();t!==this.currentIndex&&(console.log(`Downswitching to rendition: ${this.renditions[t].resolution}`),this.loadRendition(t))}async loadRendition(t){this.currentIndex=t;const r=this.renditions[t];console.log(`Loading rendition: ${r.resolution}`);const p=await Ae(r.url),{segmentUrls:h}=await Pe(p,r.url);await this.engine.clearBuffer(),this.engine.requestedSegments.clear(),this.engine.loadSegments(h,this.videoEl.currentTime)}destroy(){this.interval&&(clearInterval(this.interval),this.interval=void 0),this.manualIndex=null}}class En{constructor(){q(this,"fastAlpha",Math.exp(Math.log(.5)/2));q(this,"slowAlpha",Math.exp(Math.log(.5)/5));q(this,"fastEstimate",0);q(this,"slowEstimate",0);q(this,"totalBytesSampled",0);q(this,"minTotalBytes",128*1024);q(this,"minBytes",16*1024)}onSegmentDownloaded(t){if(t.sizeBytes<this.minBytes){console.warn("Ignoring small download for bandwidth estimation");return}const r=t.sizeBytes*8*1e3/t.downloadTimeMs,p=t.downloadTimeMs/1e3;this.totalBytesSampled+=t.sizeBytes;const h=Math.pow(this.fastAlpha,p);this.fastEstimate=r*(1-h)+h*this.fastEstimate;const m=Math.pow(this.slowAlpha,p);this.slowEstimate=r*(1-m)+m*this.slowEstimate}getBandwidthEstimate(t=1e6){return this.totalBytesSampled<this.minTotalBytes?t:this.fastEstimate}reset(){this.fastEstimate=0,this.slowEstimate=0,this.totalBytesSampled=0}destroy(){this.reset()}}const Rn=({src:f,abr:t="fixed",onDebugInfoUpdate:r})=>{const p=ni(null),[h,m]=ne(null),[_,v]=ne([]),[g,c]=ne(null),a=ni(null),l=async s=>{t==="fixed"&&g instanceof ur&&await g.setManualRendition(s)},i=()=>{console.warn("Playback stalled"),g&&typeof g.onPlaybackStall=="function"&&g.onPlaybackStall()};return Ue(()=>{if(!f||!p.current)return;Pn();async function s(){const u=p.current,n=await An(f);if(v(n),!n.length)return;const e=n[0],o=await Ae(e.url),{segmentUrls:x,totalDuration:y}=await Pe(o,e.url),b=e.codecs;g&&g.destroy(),a.current&&a.current.destroy();const F=new En;a.current=F;let S;h?(await h.reset(),S=h):(S=new Fn(u,y,b,a.current),m(S),await S.loadSegments(x,0));let w;if(t==="buffer-based")w=new In;else if(t==="fixed")w=new ur;else if(t==="network-throughput")w=new Cn;else throw new Error(`Unsupported ABR type: ${t}`);w.initialize(u,n,S,F),c(w)}return s(),()=>{g==null||g.destroy(),h==null||h.destroy()}},[f,t]),Ue(()=>{const s=p.current;if(!s)return;const u=()=>{console.log("Video is waiting"),i()},n=()=>{const o=s.buffered,x=s.currentTime;let y=!0;for(let b=0;b<o.length;b++)if(x>=o.start(b)&&x<=o.end(b)){y=!1;break}y&&(console.log("Detected potential stall during timeupdate"),i())};s.addEventListener("waiting",u),s.addEventListener("timeupdate",n);const d=()=>{console.error("Video error:",s.error)},e=()=>{s.play().catch(o=>console.error("Play error:",o))};return s.addEventListener("error",d),s.addEventListener("canplay",e),()=>{s.removeEventListener("error",d),s.removeEventListener("canplay",e)}},[]),Ue(()=>{const s=p.current;if(!s||!g)return;const n=setInterval(()=>{var x;const d=g.getRendition(),e=((x=a==null?void 0:a.current)==null?void 0:x.getBandwidthEstimate())||0,o=s.buffered.length?s.buffered.end(0)-s.currentTime:0;r({currentRendition:d?d.resolution:"Unknown",estimatedBandwidth:e,bufferLength:o})},1e3);return()=>{clearInterval(n)}},[g,_,r]),X(se,{children:[X("video",{ref:p,width:"640",height:"360",controls:!0}),t==="fixed"&&X(Un,{renditions:_,onSelect:l})]})},Ln=f=>f>=1e9?`${(f/1e9).toFixed(2)} Gbps`:f>=1e6?`${(f/1e6).toFixed(2)} Mbps`:f>=1e3?`${(f/1e3).toFixed(2)} Kbps`:`${f.toFixed(2)} bps`,Mn=()=>{const[f,t]=ne(""),[r,p]=ne("network-throughput"),[h,m]=ne({currentRendition:"",estimatedBandwidth:0,bufferLength:0}),_=v=>{const g=v.target;t(g.value)};return X(se,{children:[X("div",{children:[X("h1",{children:"Video Player"}),X(Rn,{src:f,abr:r,onDebugInfoUpdate:m})]}),X("div",{children:[X("h2",{children:"Debug Panel"}),X("p",{children:[X("strong",{children:"Current Rendition:"}),h.currentRendition]}),X("p",{children:[X("strong",{children:"Estimated Bandwidth:"}),Ln(h.estimatedBandwidth)]}),X("p",{children:[X("strong",{children:"Buffer Length:"}),h.bufferLength.toFixed(2)," seconds"]})]}),X("input",{type:"text",placeholder:"Enter manifest URL",value:f,onChange:_}),X("div",{children:[X("label",{children:"ABR Mode:"}),X("select",{value:r,onChange:v=>p(v.currentTarget.value),children:[X("option",{value:"fixed",children:"Fixed"}),X("option",{value:"buffer-based",children:"Buffer-based"}),X("option",{value:"network-throughput",children:"Network Throughput"})]})]})]})},lr=document.getElementById("root");lr&&Gr(X(Mn,{}),lr);
